<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ustaz AI - Digital Dakwah Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;600;700&display=swap" rel="stylesheet">
    <script>
        // Function to get dynamic proxy URL
        function getProxyURL() {
            const protocol = window.location.protocol;
            const hostname = window.location.hostname;
            const port = window.location.port ? `:${window.location.port}` : '';
            
            // For local development
            if (hostname === 'localhost' || hostname === '127.0.0.1') {
                return `${protocol}//${hostname}${port}/api/gemini-proxy`;
            }
            
            // Always use Cloudflare Pages domain for API (where the function is deployed)
            // GitHub Pages doesn't support server-side functions
            return 'https://digital.zikirnurani.com/api/gemini-proxy';
        }

        // Secure Gemini AI Configuration - API key moved to server-side proxy
        const GEMINI_CONFIG = {
            // API_KEY removed for security - now handled by server proxy
            PROXY_URL: getProxyURL(), // Dynamic secure server endpoint
            MAX_TOKENS: 1000,
            TEMPERATURE: 0.7,
            RETRY_ATTEMPTS: 2,
            TIMEOUT: 10000
        };
        
        // Security note: API key is now securely stored on server-side
        // and accessed through the proxy endpoint above
        console.log('ğŸ”— Ustaz Chat: Proxy URL configured as:', GEMINI_CONFIG.PROXY_URL);
    </script>
    <style>
        body { font-family: 'Sora', sans-serif; }
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .chat-bubble-user {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        .chat-bubble-ustaz {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        .typing-indicator {
            animation: pulse 1.5s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 1; }
        }
        
        /* Mobile menu animations */
        #mobileMenu {
            transition: all 0.3s ease-in-out;
            max-height: 0;
            overflow: hidden;
        }
        #mobileMenu:not(.hidden) {
            max-height: 400px;
        }
        
        /* Ensure mobile menu is hidden on desktop */
        @media (min-width: 768px) {
            #mobileMenu {
                display: none !important;
            }
        }
        
        /* Ensure header is always visible */
        header {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        /* Backup backdrop blur for better browser support */
        .backdrop-blur {
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        /* Floating Help Dropdown Styles */
        .help-tab {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #9ca3af;
        }
        .help-tab.active {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid rgba(34, 197, 94, 0.4);
            color: #10b981;
        }
        .help-tab:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        /* Enhanced Mobile Compatibility */
        @media (max-width: 768px) {
            /* Container padding adjustments */
            .container {
                padding-left: 1rem;
                padding-right: 1rem;
            }

            /* Full screen mobile layout */
            body {
                overflow-x: hidden;
            }

            /* Reduce header content for mobile */
            .container.mx-auto.px-4.py-8.max-w-4xl.pt-28 {
                padding-top: 6rem;
                padding-bottom: 0;
                height: 100vh;
                display: flex;
                flex-direction: column;
            }

            /* Minimize profile header on mobile */
            .glass-card.rounded-xl.p-6.mb-6 {
                padding: 1rem;
                margin-bottom: 0.5rem;
                flex-shrink: 0;
            }

            /* Hide detailed profile info on mobile */
            .glass-card.rounded-xl.p-6.mb-6 .mt-4 {
                display: none;
            }

            /* Minimize floating helper on mobile */
            .mb-4.relative {
                margin-bottom: 0.5rem;
                flex-shrink: 0;
            }

            /* Chat container takes remaining space */
            .glass-card.rounded-xl.overflow-hidden {
                flex: 1;
                display: flex;
                flex-direction: column;
                margin-bottom: 1rem;
                min-height: 0;
            }

            /* Chat messages fill available space */
            #chatMessages {
                flex: 1;
                padding: 1rem;
                min-height: 0;
                overflow-y: auto;
            }

            /* Input area stays at bottom */
            .border-t.border-white\/10.p-6 {
                padding: 1rem;
                flex-shrink: 0;
            }
            
            /* Message bubbles mobile spacing */
            .chat-bubble-user,
            .chat-bubble-ustaz {
                max-width: 90%;
                padding: 0.75rem;
                font-size: 0.9rem;
                line-height: 1.4;
            }
            
            /* Input area mobile optimization */
            .flex.space-x-4 {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            #messageInput {
                margin-bottom: 0.5rem;
                font-size: 1rem;
            }
            
            #sendButton {
                width: 100%;
                padding: 0.875rem;
                font-size: 1rem;
            }
            
            /* Quick action buttons mobile */
            .quick-greeting,
            .popular-question,
            .topic-button {
                font-size: 0.8rem;
                padding: 0.5rem;
            }
            
            /* Grid adjustments for mobile */
            .grid[class*="grid-cols-2"] {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            
            /* Header mobile adjustments */
            h1 {
                font-size: 1.5rem;
            }
            
            /* Floating helper mobile */
            .help-tab {
                font-size: 0.75rem;
                padding: 0.5rem 0.75rem;
            }

            /* Hide non-essential content on mobile */
            .mt-6.text-center.text-xs.text-gray-500,
            .mt-6.bg-gradient-to-r {
                display: none !important;
            }

            /* Better touch targets */
            button {
                min-height: 44px;
            }
        }
        
        /* Landscape phone optimization */
        @media (max-width: 768px) and (orientation: landscape) {
            #chatMessages {
                height: 60vh;
            }
    </style>
</head>
<body class="bg-[#000711] text-gray-200 min-h-screen">

    <!-- Header Navigation -->
    <header id="header" class="fixed top-0 left-0 right-0 z-50 transition-all duration-300 bg-[#000711]/90 backdrop-blur border-b border-white/10">
        <div class="container mx-auto px-6 py-4">
            <div class="glass-card rounded-full px-6 py-2 flex justify-between items-center">
                <h1 class="text-lg font-bold text-white">Digital Dakwah Platform</h1>
                
                <!-- Desktop Navigation -->
                <nav class="hidden md:flex space-x-6">
                    <a href="index.html" class="text-gray-300 hover:text-white transition">Home</a>
                    <a href="marketplace.html" class="text-gray-300 hover:text-white transition">Marketplace</a>
                    <a href="ustaz.html" class="text-white bg-green-500/20 px-3 py-1 rounded-lg border border-green-400/30">Ask Ustaz</a>
                    <a href="LearnIqro.html" class="text-gray-300 hover:text-white transition">Learn Iqro</a>
                    <a href="mindmap.html" class="text-gray-300 hover:text-white transition">Mindmap</a>
                </nav>

                <!-- Mobile Menu Button -->
                <button id="mobileMenuToggle" class="md:hidden text-white p-2 rounded-lg hover:bg-white/10 transition-colors focus:outline-none focus:ring-2 focus:ring-green-400" aria-label="Toggle mobile menu">
                    <svg class="w-6 h-6 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path id="menuIcon" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>

                <!-- Desktop Get Involved Button -->
                <a href="index.html#contact" class="hidden md:block bg-white text-blue-900 font-bold py-2 px-5 rounded-full hover:bg-gray-200 transition duration-300 transform hover:scale-105 shadow-lg">Get Involved</a>
            </div>

            <!-- Mobile Navigation Menu -->
            <div id="mobileMenu" class="md:hidden mt-4 hidden">
                <div class="glass-card rounded-lg px-4 py-4 space-y-2">
                    <a href="index.html" class="block text-gray-300 hover:text-white transition py-3 px-4 rounded-lg hover:bg-white/10 border-b border-white/10">
                        ğŸ  Home
                    </a>
                    <a href="marketplace.html" class="block text-gray-300 hover:text-white transition py-3 px-4 rounded-lg hover:bg-white/10 border-b border-white/10">
                        ğŸ›’ Marketplace
                    </a>
                    <a href="ustaz.html" class="block text-white bg-green-500/20 py-3 px-4 rounded-lg border border-green-400/30">
                        ğŸ¤– Ask Ustaz (Current)
                    </a>
                    <a href="LearnIqro.html" class="block text-gray-300 hover:text-white transition py-3 px-4 rounded-lg hover:bg-white/10 border-b border-white/10">
                        ğŸ“– Learn Iqro
                    </a>
                    <a href="mindmap.html" class="block text-gray-300 hover:text-white transition py-3 px-4 rounded-lg hover:bg-white/10 border-b border-white/10">
                        ğŸ§  Mindmap
                    </a>
                    <a href="index.html#contact" class="block text-center bg-white text-blue-900 font-bold py-3 px-4 rounded-lg hover:bg-gray-200 transition">
                        ğŸ“ Get Involved
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content with top padding for fixed header -->
    <div class="container mx-auto px-4 py-8 max-w-4xl pt-28">
        
        <!-- Header -->
        <div class="glass-card rounded-xl p-6 mb-6">
            <div class="flex items-center space-x-4">
                <div class="w-16 h-16 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center">
                    <span class="text-white text-2xl">ğŸ§ </span>
                </div>
                <div>
                    <h1 class="text-2xl font-bold text-green-300">Ustaz Radhi</h1>
                    <p class="text-gray-400">AI Assistant â€¢ Motivator â€¢ Pendengar â€¢ Deep-Talk Partner</p>
                    <div class="flex items-center space-x-2 mt-2">
                        <div class="w-3 h-3 bg-green-400 rounded-full"></div>
                        <span class="text-sm text-green-400">Online & Siap Membantu</span>
                    </div>
                </div>
            </div>
            
            <!-- Quick Guidelines -->
            <div class="mt-4 p-4 bg-green-500/10 rounded-lg border border-green-500/20">
                <h3 class="text-green-300 font-semibold mb-2">ğŸŒŸ Ustaz Radhi Siap Membantu Anda:</h3>
                <div class="grid md:grid-cols-2 gap-2 text-sm text-gray-300">
                    <div>ğŸ’ª <strong>Motivator:</strong> Nasihat & semangat hidup</div>
                    <div>ğŸ‘‚ <strong>Pendengar:</strong> Tempat meluahkan perasaan</div>
                    <div>ğŸ’­ <strong>Deep-Talk:</strong> Bicara mendalam tentang hidup</div>
                    <div>ğŸ“– <strong>Guru Agama:</strong> Fiqh & Ibadah (Mazhab Syafie)</div>
                    <div>ğŸ¤² <strong>Spiritual Guide:</strong> Al-Quran & Hadith</div>
                    <div>â¤ï¸ <strong>Penyembuh Hati:</strong> Akhlaq & Adab Islam</div>
                </div>
            </div>
        </div>

        <!-- Floating Question Helper - Above Chatbox -->
        <div class="mb-4 relative">
            <!-- Main Helper Button -->
            <div class="flex justify-center mb-4">
                <button id="helpToggle" class="glass-card px-6 py-3 rounded-full text-green-300 font-semibold hover:bg-green-500/10 transition-all duration-300 transform hover:scale-105 shadow-lg border border-green-500/30">
                    ğŸ’¡ Quick Questions Helper
                    <span id="helpArrow" class="ml-2 transform transition-transform duration-200">â–¼</span>
                </button>
            </div>

            <!-- Floating Dropdown Menu -->
            <div id="helpDropdown" class="hidden absolute top-full left-0 right-0 z-10 mt-2">
                <div class="glass-card rounded-xl p-6 border border-white/20 shadow-2xl backdrop-blur-lg">
                    <!-- Quick Helper Tabs -->
                    <div class="flex flex-wrap gap-2 mb-4">
                        <button class="help-tab active px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200" data-category="sample">
                            ğŸ’¡ Sample Questions
                        </button>
                        <button class="help-tab px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200" data-category="greetings">
                            ğŸ‘‹ Greetings
                        </button>
                        <button class="help-tab px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200" data-category="popular">
                            ğŸ”¥ Popular
                        </button>
                        <button class="help-tab px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200" data-category="topics">
                            ğŸ“š Topics
                        </button>
                        <button class="help-tab px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200" data-category="sources">
                            ğŸ“– Sources
                        </button>
                    </div>

                    <!-- Sample Questions Content -->
                    <div id="help-sample" class="help-content">
                        <div class="space-y-3">
                            <button class="sample-question w-full text-left p-3 rounded-lg bg-blue-500/10 hover:bg-blue-500/20 transition-all duration-200 text-sm text-gray-300 border border-blue-500/30 hover:border-blue-400/50">
                                "Bagaimana cara solat dengan sempurna menurut mazhab Syafie?"
                            </button>
                            <button class="sample-question w-full text-left p-3 rounded-lg bg-blue-500/10 hover:bg-blue-500/20 transition-all duration-200 text-sm text-gray-300 border border-blue-500/30 hover:border-blue-400/50">
                                "Apakah hukum zakat fitrah dan berapa kadarnya?"
                            </button>
                            <button class="sample-question w-full text-left p-3 rounded-lg bg-blue-500/10 hover:bg-blue-500/20 transition-all duration-200 text-sm text-gray-300 border border-blue-500/30 hover:border-blue-400/50">
                                "Boleh terangkan tentang adab ketika membaca Al-Quran?"
                            </button>
                        </div>
                    </div>

                    <!-- Greetings Content -->
                    <div id="help-greetings" class="help-content hidden">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                            <button class="quick-greeting w-full text-left p-3 rounded-lg bg-green-500/10 hover:bg-green-500/20 transition-all duration-200 text-sm text-gray-300 border border-green-500/30 hover:border-green-400/50">
                                ğŸ•Œ Assalamualaikum
                            </button>
                            <button class="quick-greeting w-full text-left p-3 rounded-lg bg-green-500/10 hover:bg-green-500/20 transition-all duration-200 text-sm text-gray-300 border border-green-500/30 hover:border-green-400/50">
                                ğŸ˜Š Selamat pagi Ustaz
                            </button>
                            <button class="quick-greeting w-full text-left p-3 rounded-lg bg-green-500/10 hover:bg-green-500/20 transition-all duration-200 text-sm text-gray-300 border border-green-500/30 hover:border-green-400/50">
                                ğŸŒ™ Selamat petang Ustaz
                            </button>
                            <button class="quick-greeting w-full text-left p-3 rounded-lg bg-green-500/10 hover:bg-green-500/20 transition-all duration-200 text-sm text-gray-300 border border-green-500/30 hover:border-green-400/50">
                                ğŸ¤ Apa khabar Ustaz?
                            </button>
                        </div>
                    </div>

                    <!-- Popular Questions Content -->
                    <div id="help-popular" class="help-content hidden">
                        <div class="space-y-2">
                            <button class="popular-question w-full text-left p-3 rounded-lg bg-purple-500/10 hover:bg-purple-500/20 transition-all duration-200 text-sm text-gray-300 border border-purple-500/30 hover:border-purple-400/50">
                                ğŸ“¿ Cara bertaubat yang betul
                            </button>
                            <button class="popular-question w-full text-left p-3 rounded-lg bg-purple-500/10 hover:bg-purple-500/20 transition-all duration-200 text-sm text-gray-300 border border-purple-500/30 hover:border-purple-400/50">
                                ğŸ’° Hukum simpan wang dalam bank
                            </button>
                            <button class="popular-question w-full text-left p-3 rounded-lg bg-purple-500/10 hover:bg-purple-500/20 transition-all duration-200 text-sm text-gray-300 border border-purple-500/30 hover:border-purple-400/50">
                                ğŸ¤² Doa selepas solat yang mustajab
                            </button>
                            <button class="popular-question w-full text-left p-3 rounded-lg bg-purple-500/10 hover:bg-purple-500/20 transition-all duration-200 text-sm text-gray-300 border border-purple-500/30 hover:border-purple-400/50">
                                ğŸ‘¥ Adab bergaul dalam Islam
                            </button>
                            <button class="popular-question w-full text-left p-3 rounded-lg bg-purple-500/10 hover:bg-purple-500/20 transition-all duration-200 text-sm text-gray-300 border border-purple-500/30 hover:border-purple-400/50">
                                ğŸ½ï¸ Hukum makanan halal dan haram
                            </button>
                        </div>
                    </div>

                    <!-- Topics Content -->
                    <div id="help-topics" class="help-content hidden">
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
                            <button class="topic-button w-full text-center p-3 rounded-lg bg-orange-500/10 hover:bg-orange-500/20 transition-all duration-200 text-sm text-gray-300 border border-orange-500/30 hover:border-orange-400/50">
                                ğŸ•Œ Solat
                            </button>
                            <button class="topic-button w-full text-center p-3 rounded-lg bg-orange-500/10 hover:bg-orange-500/20 transition-all duration-200 text-sm text-gray-300 border border-orange-500/30 hover:border-orange-400/50">
                                ğŸ’° Zakat
                            </button>
                            <button class="topic-button w-full text-center p-3 rounded-lg bg-orange-500/10 hover:bg-orange-500/20 transition-all duration-200 text-sm text-gray-300 border border-orange-500/30 hover:border-orange-400/50">
                                ğŸŒ™ Puasa
                            </button>
                            <button class="topic-button w-full text-center p-3 rounded-lg bg-orange-500/10 hover:bg-orange-500/20 transition-all duration-200 text-sm text-gray-300 border border-orange-500/30 hover:border-orange-400/50">
                                ğŸ•‹ Haji
                            </button>
                            <button class="topic-button w-full text-center p-3 rounded-lg bg-orange-500/10 hover:bg-orange-500/20 transition-all duration-200 text-sm text-gray-300 border border-orange-500/30 hover:border-orange-400/50">
                                ğŸ“– Al-Quran
                            </button>
                            <button class="topic-button w-full text-center p-3 rounded-lg bg-orange-500/10 hover:bg-orange-500/20 transition-all duration-200 text-sm text-gray-300 border border-orange-500/30 hover:border-orange-400/50">
                                ğŸ¤² Doa
                            </button>
                        </div>
                    </div>

                    <!-- Sources Content -->
                    <div id="help-sources" class="help-content hidden">
                        <div class="space-y-3">
                            <div class="bg-blue-500/10 rounded-lg p-3 border border-blue-500/20">
                                <h5 class="text-blue-200 font-medium mb-2">ğŸ“– Al-Quran al-Kareem</h5>
                                <p class="text-gray-300 text-sm">Kitab suci umat Islam, firman Allah SWT yang diturunkan kepada Nabi Muhammad SAW.</p>
                            </div>
                            <div class="bg-blue-500/10 rounded-lg p-3 border border-blue-500/20">
                                <h5 class="text-blue-200 font-medium mb-2">ğŸ“ Hadis & Sunnah</h5>
                                <p class="text-gray-300 text-sm">Sabda, perbuatan dan ketetapan Rasulullah SAW sebagai panduan hidup.</p>
                            </div>
                            <div class="bg-blue-500/10 rounded-lg p-3 border border-blue-500/20">
                                <h5 class="text-blue-200 font-medium mb-2">âš–ï¸ Fiqh Mazhab Syafie</h5>
                                <p class="text-gray-300 text-sm">Panduan hukum Islam mengikut mazhab yang diamalkan di Malaysia dan Asia Tenggara.</p>
                            </div>
                            <div class="bg-blue-500/10 rounded-lg p-3 border border-blue-500/20">
                                <h5 class="text-blue-200 font-medium mb-2">ğŸ›ï¸ Institusi Islam Malaysia</h5>
                                <p class="text-gray-300 text-sm">JAKIM, Mufti negeri, dan institusi Islam yang diiktiraf di Malaysia.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chat Container -->
        <div class="glass-card rounded-xl overflow-hidden">

            <!-- Chat Messages Area -->
            <div id="chatMessages" class="h-96 md:h-96 overflow-y-auto p-6 space-y-4">

                <!-- Welcome Message -->
                <div class="flex items-start space-x-3">
                    <div class="w-8 h-8 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center flex-shrink-0">
                        <span class="text-white text-sm">ğŸ§ </span>
                    </div>
                    <div class="chat-bubble-ustaz rounded-lg p-4 max-w-md">
                        <div class="text-sm text-green-300 font-semibold mb-1">Ustaz Radhi</div>
                        <div class="text-gray-200">
                            Assalamualaikum warahmatullahi wabarakatuh. Selamat datang ke Digital Dakwah Platform!

                            Saya Ustaz Radhi - bukan sahaja pembantu agama, tetapi juga:
                            ğŸ’ª <strong>Motivator</strong> untuk yang berasa down
                            ğŸ‘‚ <strong>Pendengar</strong> untuk yang sedih
                            ğŸ’­ <strong>Deep-talk partner</strong> untuk bicara mendalam

                            Ceritakanlah apa sahaja yang di hati. Saya di sini untuk anda! ğŸ¤²
                        </div>
                    </div>
                </div>

            </div>

            <!-- Typing Indicator (Hidden by default) -->
            <div id="typingIndicator" class="hidden px-6 py-2">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center">
                        <span class="text-white text-sm">ğŸ§ </span>
                    </div>
                    <div class="typing-indicator text-gray-400 text-sm">
                        Ustaz Radhi sedang menaip...
                    </div>
                </div>
            </div>

            <!-- Chat Input Area -->
            <div class="border-t border-white/10 p-6">
                <div class="flex space-x-4">
                    <input 
                        type="text" 
                        id="messageInput" 
                        placeholder="Be respectful, Jazakallahu khairan." 
                        class="flex-1 bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-400 focus:border-transparent"
                        maxlength="300"
                    >
                    <button 
                        id="sendButton" 
                        class="bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white px-6 py-3 rounded-lg font-semibold transition-all duration-300 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                        Hantar
                    </button>
                </div>
                <div class="mt-2 text-xs text-gray-500">
                    Tekan Enter untuk hantar. Maksimum 200 aksara.
                </div>
            </div>
        </div>

        <!-- Disclaimer -->
        <div class="mt-6 text-center text-xs text-gray-500 bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-4">
            <p class="mb-2">âš ï¸ <strong>Penafian:</strong> Saya adalah AI Assistant dalam platform ini sahaja </p>
            <p>Untuk keputusan penting atau isu kompleks, sila rujuk ustaz berkelayakan di masjid tempatan. Wallahu a'lam bissawab.</p>
        </div>

        <!-- Platform Information Section -->
        <div class="mt-6 bg-gradient-to-r from-green-500/10 to-blue-500/10 border border-green-500/20 rounded-lg p-6">
            <h3 class="text-green-300 font-bold text-lg mb-4 text-center">ğŸŒŸ Tentang Digital Dakwah Platform</h3>
            
            <div class="space-y-4 text-sm text-gray-300">
                <div class="bg-white/5 rounded-lg p-4">
                    <h4 class="text-blue-300 font-semibold mb-2">ğŸ¯ Visi Platform:</h4>
                    <p class="text-gray-200 italic">"Menjadi platform dakwah digital terdepan yang menghubungkan teknologi moden dengan nilai-nilai Islam tradisional untuk menyebarkan ilmu agama yang sahih dan mudah diakses oleh semua lapisan masyarakat."</p>
                </div>
                
                <div class="bg-white/5 rounded-lg p-4">
                    <h4 class="text-purple-300 font-semibold mb-2">ğŸš€ Misi Kami:</h4>
                    <ul class="space-y-1 text-gray-200">
                        <li>â€¢ Memudahkan akses kepada ilmu agama Islam yang sahih dan berdasarkan dalil</li>
                        <li>â€¢ Memberikan panduan praktis untuk kehidupan mengikut Islam</li>
                        <li>â€¢ Menyebarkan dakwah secara digital yang berkesan</li>
                        <li>â€¢ Memupuk komuniti Muslim yang berilmu dan bertakwa</li>
                        <li>â€¢ Menyokong dakwah dan pendidikan Islam berkelanjutan</li>
                    </ul>
                </div>
                
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="bg-white/5 rounded-lg p-4">
                        <h4 class="text-orange-300 font-semibold mb-2">ğŸ”— Rujukan Berguna:</h4>
                        <ul class="space-y-1 text-gray-200 text-xs">
                            <li>â€¢ Fatwa rasmi: <a href="https://www.islam.gov.my" class="text-green-400 hover:text-green-300">JAKIM</a></li>
                            <li>â€¢ Zakat Sabah: <a href="https://appszakat.sabah.gov.my" class="text-green-400 hover:text-green-300">MAIS Sabah</a></li>
                            <li>â€¢ Waktu solat: Rujuk aplikasi solat tempatan</li>
                        </ul>
                    </div>
                    
                    <div class="bg-white/5 rounded-lg p-4">
                        <h4 class="text-cyan-300 font-semibold mb-2">ğŸŒ Platform Features:</h4>
                        <ul class="space-y-1 text-gray-200 text-xs">
                            <li>â€¢ <span class="text-green-400">Ask Ustaz</span> - Soalan agama (sedang anda gunakan)</li>
                            <li>â€¢ <span class="text-blue-400">Marketplace</span> - Produk & perkhidmatan Islami</li>
                            <li>â€¢ <span class="text-purple-400">Mindmap</span> - Peta minda pembelajaran Islam</li>
                        </ul>
                    </div>
                </div>
                
                <div class="text-center pt-2">
                    <p class="text-green-300 font-medium">â“ Ada soalan lanjut? Platform ini sedia membantu 24/7! ğŸ¤²</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Chat functionality
        class UstazRadhiChat {
            constructor() {
                // Cloudflare KV Integration
                this.userId = this.generateUserId();
                // KV Worker configuration - using Cloudflare Pages API
                this.workerEndpoint = 'https://digital.zikirnurani.com'; // Cloudflare Pages domain
                
                // Conversation memory structure
                this.conversationMemory = {
                    currentTopic: null,
                    messageHistory: [],
                    userProfile: {
                        interests: [],
                        previousTopics: [],
                        emotionalState: 'neutral',
                        preferredResponseStyle: 'detailed'
                    },
                    sessionStart: Date.now(),
                    totalInteractions: 0
                };
                
                // Main properties
                this.currentTopic = null;
                this.messageHistory = [];
                this.userProfile = this.conversationMemory.userProfile;
                
                // DOM elements
                this.messageInput = document.getElementById('messageInput');
                this.sendButton = document.getElementById('sendButton');
                this.chatMessages = document.getElementById('chatMessages');
                this.typingIndicator = document.getElementById('typingIndicator');
                this.hasGreeted = false; // Track if user has been greeted already
                
                this.initializeEventListeners();
                this.initializeSampleQuestions();

                // Initialize conversation system with KV
                this.initializeConversationSystem();

                console.log('âœ… UstazRadhiChat initialized with floating help system');
            }

            generateUserId() {
                let userId = localStorage.getItem('ustazRadhiUserId');
                if (!userId) {
                    userId = 'ustaz_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    localStorage.setItem('ustazRadhiUserId', userId);
                    console.log('ğŸ†” Generated new user ID:', userId);
                }
                return userId;
            }

            async initializeConversationSystem() {
                try {
                    console.log('ğŸ”„ Initializing conversation system...');
                    
                    // Load existing conversation from Cloudflare KV (with localStorage fallback)
                    const loaded = await this.loadConversationFromKV();
                    
                    if (loaded) {
                        console.log('âœ… Conversation loaded from storage');
                        // Show welcome back message if returning user
                        if (this.messageHistory.length > 0) {
                            setTimeout(() => {
                                this.showWelcomeBackMessage();
                            }, 2000);
                        }
                    } else {
                        console.log('ğŸ†• New user - starting fresh conversation');
                    }
                    
                    // Auto-save conversation every 30 seconds
                    setInterval(() => {
                        this.saveConversationToKV();
                    }, 30000);

                    // Save on page unload
                    window.addEventListener('beforeunload', () => {
                        this.saveConversationToKV();
                    });

                } catch (error) {
                    console.log('â„¹ï¸ Conversation system initialized with fallback mode:', error.message);
                    // Fallback to existing local storage method
                    this.loadConversationMemory();
                }
            }

            loadConversationFromLocalStorage() {
                try {
                    console.log('ğŸ“¥ Loading conversation from localStorage for user:', this.userId);
                    
                    // Load from localStorage backup
                    const backupData = localStorage.getItem(`ustaz_conversation_${this.userId}`);
                    if (backupData) {
                        const data = JSON.parse(backupData);
                        this.currentTopic = data.currentTopic || null;
                        this.messageHistory = data.messageHistory || [];
                        this.userProfile = data.userProfile || this.userProfile;
                        this.conversationMemory = data;
                        
                        console.log('âœ… Conversation loaded from localStorage - Messages:', this.messageHistory.length);
                        return true;
                    } else {
                        console.log('ğŸ†• No existing conversation found in localStorage');
                        return false;
                    }
                    
                } catch (error) {
                    console.log('â„¹ï¸ localStorage load failed:', error.message);
                    return false;
                }
            }

            saveConversationToLocalStorage() {
                try {
                    const memory = {
                        currentTopic: this.currentTopic,
                        messageHistory: this.messageHistory.slice(-20), // Keep last 20 messages
                        userProfile: this.userProfile,
                        sessionStart: this.conversationMemory.sessionStart || Date.now(),
                        totalInteractions: this.messageHistory.length,
                        lastActivity: Date.now()
                    };

                    console.log('ğŸ’¾ Saving conversation to localStorage...', memory);
                    
                    localStorage.setItem(`ustaz_conversation_${this.userId}`, JSON.stringify(memory));
                    console.log('âœ… Conversation saved to localStorage successfully');
                    
                } catch (error) {
                    console.log('â„¹ï¸ localStorage save failed:', error.message);
                }
            }

            async loadConversationFromKV() {
                try {
                    console.log('ğŸ“¥ Loading conversation from KV for user:', this.userId);
                    
                    const response = await fetch(`${this.workerEndpoint}/api/conversation/load?userId=${this.userId}`, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });

                    if (response.ok) {
                        const data = await response.json();
                        console.log('ğŸ“‹ KV Response:', data);
                        
                        if (data.success && data.found && data.conversation) {
                            // Load conversation data
                            this.currentTopic = data.conversation.currentTopic;
                            this.messageHistory = data.conversation.messageHistory || [];
                            this.userProfile = data.conversation.userProfile || this.userProfile;
                            this.conversationMemory = data.conversation;
                            
                            console.log('âœ… Conversation loaded from KV - Messages:', this.messageHistory.length);
                            return true;
                        } else if (data.fallback) {
                            console.log('âš ï¸ KV not configured, falling back to localStorage');
                            return this.loadConversationFromLocalStorage();
                        } else {
                            console.log('ğŸ†• No existing conversation found in KV');
                            return false;
                        }
                    } else {
                        console.log('âš ï¸ KV load failed, falling back to localStorage:', response.status);
                        return this.loadConversationFromLocalStorage();
                    }
                } catch (error) {
                    console.log('âš ï¸ KV load error, falling back to localStorage:', error.message);
                    return this.loadConversationFromLocalStorage();
                }
            }

            async saveConversationToKV() {
                // Always save to localStorage as backup
                this.saveConversationToLocalStorage();
                
                // Try to save to KV storage for persistence across devices
                try {
                    const memory = {
                        currentTopic: this.currentTopic,
                        messageHistory: this.messageHistory.slice(-20),
                        userProfile: this.userProfile,
                        sessionStart: this.conversationMemory.sessionStart || Date.now(),
                        totalInteractions: this.messageHistory.length,
                        lastActivity: Date.now()
                    };

                    console.log('ğŸ’¾ Saving conversation to KV...', memory);

                    const response = await fetch(`${this.workerEndpoint}/api/conversation/save`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            userId: this.userId,
                            conversation: memory
                        })
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        console.log('âœ… Saved to Cloudflare KV:', result.message);
                    } else {
                        console.log('âš ï¸ KV save failed, using localStorage backup:', response.status);
                    }
                } catch (error) {
                    console.log('âš ï¸ KV save error, using localStorage backup:', error.message);
                }
            }

            showWelcomeBackMessage() {
                const totalMessages = this.messageHistory.filter(m => m.sender === 'user').length;
                const lastTopic = this.currentTopic || 'Perbincangan umum';
                const interests = this.userProfile.interests.slice(0, 3).join(', ') || 'Belum dikenal pasti';
                
                const welcomeMessage = `**ğŸŒŸ Assalamualaikum dan selamat kembali!** 

Alhamdulillah, saya ingat perbualan kita sebelum ini! 

ğŸ“Š **Ringkasan Perbualan Lepas:**
â€¢ **Topik terakhir**: ${lastTopic}
â€¢ **Jumlah soalan**: ${totalMessages} soalan
â€¢ **Minat utama**: ${interests}

${this.currentTopic ? `Adakah saudara/saudari ingin meneruskan perbualan tentang **${this.currentTopic}** atau ada topik lain yang ingin dibincangkan?` : 'Apa yang boleh saya bantu hari ini? ğŸ¤²'}

**ğŸ’¡ Cadangan Berdasarkan Perbualan Lepas:**
â€¢ **Mendalami topik** yang pernah kita bincang
â€¢ **Mengaitkan dengan kehidupan** seharian
â€¢ **Belajar aspek praktikal** dari ilmu yang telah dipelajari

Sila berasa selesa untuk bertanya apa sahaja! Mari kita teruskan pembelajaran yang bermakna. âœ¨`;

                // Add welcome back message to chat
                this.addMessage(welcomeMessage, 'ustaz');
            }

            loadConversationMemory() {
                try {
                    const saved = localStorage.getItem('ustazRadhiMemory');
                    if (saved) {
                        const memory = JSON.parse(saved);
                        this.currentTopic = memory.currentTopic || null;
                        this.messageHistory = memory.messageHistory || [];
                        this.userProfile = memory.userProfile || this.userProfile;
                        this.conversationMemory = memory;
                        console.log('Loaded conversation from localStorage');
                    }
                } catch (error) {
                    console.error('Failed to load conversation memory:', error);
                }
            }

            initializeEventListeners() {
                // Send button click
                this.sendButton.addEventListener('click', () => this.sendMessage());
                
                // Enter key press
                this.messageInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.sendMessage();
                    }
                });

                // Input validation
                this.messageInput.addEventListener('input', () => {
                    this.validateInput();
                });

                // Initialize floating help dropdown
                this.initializeHelpDropdown();
            }

            initializeHelpDropdown() {
                const helpToggle = document.getElementById('helpToggle');
                const helpDropdown = document.getElementById('helpDropdown');
                const helpArrow = document.getElementById('helpArrow');
                const helpTabs = document.querySelectorAll('.help-tab');
                const helpContents = document.querySelectorAll('.help-content');

                // Toggle dropdown
                helpToggle.addEventListener('click', () => {
                    helpDropdown.classList.toggle('hidden');
                    helpArrow.style.transform = helpDropdown.classList.contains('hidden') ? 'rotate(0deg)' : 'rotate(180deg)';
                });

                // Tab switching
                helpTabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        const category = tab.dataset.category;

                        // Update active tab
                        helpTabs.forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');

                        // Show corresponding content
                        helpContents.forEach(content => {
                            if (content.id === `help-${category}`) {
                                content.classList.remove('hidden');
                            } else {
                                content.classList.add('hidden');
                            }
                        });
                    });
                });

                // Close dropdown when clicking outside
                document.addEventListener('click', (e) => {
                    if (!helpToggle.contains(e.target) && !helpDropdown.contains(e.target)) {
                        helpDropdown.classList.add('hidden');
                        helpArrow.style.transform = 'rotate(0deg)';
                    }
                });

                // Close dropdown when a question is selected
                helpDropdown.addEventListener('click', (e) => {
                    if (e.target.classList.contains('sample-question') ||
                        e.target.classList.contains('quick-greeting') ||
                        e.target.classList.contains('popular-question') ||
                        e.target.classList.contains('topic-button')) {
                        helpDropdown.classList.add('hidden');
                        helpArrow.style.transform = 'rotate(0deg)';
                    }
                });
            }

            initializeSampleQuestions() {
                // Original sample questions
                const sampleButtons = document.querySelectorAll('.sample-question');
                sampleButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const question = button.textContent.replace(/"/g, '');
                        this.messageInput.value = question;
                        this.messageInput.focus();
                    });
                });

                // Quick greeting buttons
                const greetingButtons = document.querySelectorAll('.quick-greeting');
                greetingButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const greeting = button.textContent.replace(/ğŸ•Œ|ğŸ˜Š|ğŸŒ™|ğŸ¤/g, '').trim();
                        this.messageInput.value = greeting;
                        this.sendMessage(); // Auto-send greetings
                    });
                });

                // Popular questions buttons
                const popularButtons = document.querySelectorAll('.popular-question');
                popularButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const question = this.getFullQuestionFromTopic(button.textContent.trim());
                        this.messageInput.value = question;
                        this.sendMessage(); // Auto-send the question
                    });
                });

                // Topic buttons
                const topicButtons = document.querySelectorAll('.topic-button');
                topicButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const topic = button.textContent.replace(/ğŸ•Œ|ğŸ’°|ğŸŒ™|ğŸ•‹|ğŸ“–|ğŸ¤²/g, '').trim();
                        const question = `Boleh terangkan tentang ${topic.toLowerCase()} dalam Islam?`;
                        this.messageInput.value = question;
                        this.messageInput.focus();
                    });
                });
            }

            validateInput() {
                const message = this.messageInput.value.trim();
                const isValid = message.length > 0 && message.length <= 500;
                
                this.sendButton.disabled = !isValid;
                
                // Character count (optional)
                const remaining = 500 - message.length;
                if (remaining < 50) {
                    this.messageInput.style.borderColor = remaining < 0 ? '#ef4444' : '#f59e0b';
                } else {
                    this.messageInput.style.borderColor = '';
                }
            }

            getFullQuestionFromTopic(topicText) {
                const topicMap = {
                    'ğŸ“¿ Cara bertaubat yang betul': 'Bagaimana cara bertaubat yang betul dalam Islam?',
                    'ğŸ’° Hukum simpan wang dalam bank': 'Apakah hukum menyimpan wang dalam bank yang ada faedah?',
                    'ğŸ¤² Doa selepas solat yang mustajab': 'Apakah doa-doa yang mustajab dibaca selepas solat?',
                    'ğŸ‘¥ Adab bergaul dalam Islam': 'Boleh terangkan tentang adab bergaul dalam Islam?',
                    'ğŸ½ï¸ Hukum makanan halal dan haram': 'Bagaimana nak tahu makanan halal dan haram dalam Islam?'
                };
                
                return topicMap[topicText] || topicText.replace(/ğŸ“¿|ğŸ’°|ğŸ¤²|ğŸ‘¥|ğŸ½ï¸/g, '').trim();
            }

            async sendMessage() {
                const message = this.messageInput.value.trim();
                if (!message) return;

                // Add user message to chat
                this.addMessage(message, 'user');
                
                // Update conversation memory
                this.updateConversationMemory(message, 'user');
                
                // Clear input and disable send button
                this.messageInput.value = '';
                this.sendButton.disabled = true;
                
                // Show typing indicator
                this.showTypingIndicator();

                try {
                    // Call Ustaz Radhi AI
                    const response = await this.callUstazRadhiAPI(message);
                    
                    // Hide typing indicator
                    this.hideTypingIndicator();
                    
                    // Add Ustaz response
                    this.addMessage(response, 'ustaz');
                    
                    // Update conversation memory with AI response
                    this.updateConversationMemory(response, 'ustaz');
                    
                } catch (error) {
                    console.error('Send message error:', error);
                    this.hideTypingIndicator();
                    this.addMessage('Maaf, ada masalah teknikal. Sila cuba lagi sebentar lagi.', 'ustaz');
                } finally {
                    // Re-enable send button
                    this.sendButton.disabled = false;
                }
            }

            addMessage(message, sender) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'flex items-start space-x-3';
                
                if (sender === 'user') {
                    messageDiv.innerHTML = `
                        <div class="w-8 h-8 bg-gray-600 rounded-full flex items-center justify-center flex-shrink-0">
                            <span class="text-white text-sm">ğŸ‘¤</span>
                        </div>
                        <div class="chat-bubble-user rounded-lg p-4 max-w-md ml-auto">
                            <div class="text-white">${this.escapeHtml(message)}</div>
                        </div>
                    `;
                } else {
                    messageDiv.innerHTML = `
                        <div class="w-8 h-8 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center flex-shrink-0">
                            <span class="text-white text-sm">ğŸ§ </span>
                        </div>
                        <div class="chat-bubble-ustaz rounded-lg p-4 max-w-2xl">
                            <div class="text-sm text-green-300 font-semibold mb-1">Ustaz Radhi</div>
                            <div class="text-gray-200">${this.formatUstazResponse(message)}</div>
                        </div>
                    `;
                }
                
                this.chatMessages.appendChild(messageDiv);
                this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
            }

            showTypingIndicator() {
                this.typingIndicator.classList.remove('hidden');
                this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
            }

            hideTypingIndicator() {
                this.typingIndicator.classList.add('hidden');
            }

            formatUstazResponse(message) {
                // Format the response with Islamic styling
                return message
                    .replace(/\*\*(.*?)\*\*/g, '<strong class="text-green-300">$1</strong>')
                    .replace(/ğŸ“–|ğŸ•Œ|ğŸ’¡|âš ï¸|ğŸŒŸ|âœ…/g, '<span class="text-lg">$&</span>')
                    .replace(/\n/g, '<br>');
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            updateConversationMemory(message, sender) {
                // Add to message history
                this.messageHistory.push({
                    content: message,
                    sender: sender,
                    timestamp: Date.now()
                });

                // Detect and update topic
                if (sender === 'user') {
                    const detectedTopic = this.detectTopic(message);
                    if (detectedTopic) {
                        this.currentTopic = detectedTopic;
                        if (!this.userProfile.previousTopics.includes(detectedTopic)) {
                            this.userProfile.previousTopics.push(detectedTopic);
                        }
                    }

                    // Update emotional state
                    this.userProfile.emotionalState = this.detectEmotionalState(message);

                    // Extract interests
                    const interests = this.extractInterests(message);
                    interests.forEach(interest => {
                        if (!this.userProfile.interests.includes(interest)) {
                            this.userProfile.interests.push(interest);
                        }
                    });
                }

                // Update conversation memory object
                this.conversationMemory.currentTopic = this.currentTopic;
                this.conversationMemory.messageHistory = this.messageHistory;
                this.conversationMemory.userProfile = this.userProfile;
                this.conversationMemory.totalInteractions = this.messageHistory.length;

                // Auto-save to KV (immediate save for important updates)
                if (sender === 'user') {
                    setTimeout(() => this.saveConversationToKV(), 1000);
                }
            }

            detectTopic(message) {
                const topicPatterns = {
                    'solat': /\b(solat|prayer|shalat|rukun|sujud|ruku|imam|makmum|wudhu|ablution)\b/i,
                    'puasa': /\b(puasa|fast|sahur|iftar|ramadan|berbuka|siam)\b/i,
                    'zakat': /\b(zakat|fitrah|nisab|asnaf|muzakki|mal)\b/i,
                    'haji': /\b(haji|umrah|mekah|kaabah|ihram|tawaf|saie)\b/i,
                    'doa': /\b(doa|zikir|prayer|istighfar|tasbih|wirid)\b/i,
                    'akhlaq': /\b(akhlaq|adab|perangai|tingkah|moral|etika)\b/i,
                    'motivasi': /\b(sedih|stress|down|motivasi|semangat|kecewa|depress)\b/i
                };

                for (const [topic, pattern] of Object.entries(topicPatterns)) {
                    if (pattern.test(message)) {
                        return topic;
                    }
                }
                return null;
            }

            detectEmotionalState(message) {
                const emotionalPatterns = {
                    'sad': /\b(sedih|kecewa|depress|down|lemah|putus asa)\b/i,
                    'stressed': /\b(stress|tekanan|beban|susah|sukar)\b/i,
                    'happy': /\b(gembira|senang|bahagia|syukur|alhamdulillah)\b/i,
                    'confused': /\b(keliru|pening|tak faham|confused|bingung)\b/i,
                    'seeking': /\b(nak tahu|boleh terang|ajar|panduan|cara)\b/i
                };

                for (const [emotion, pattern] of Object.entries(emotionalPatterns)) {
                    if (pattern.test(message)) {
                        return emotion;
                    }
                }
                return 'neutral';
            }

            extractInterests(message) {
                const interestPatterns = {
                    'teknologi': /\b(teknologi|digital|online|internet|media sosial)\b/i,
                    'keluarga': /\b(keluarga|anak|isteri|suami|ibu bapa|adik beradik)\b/i,
                    'kerja': /\b(kerja|pekerjaan|kerjaya|bisnes|perniagaan)\b/i,
                    'pendidikan': /\b(belajar|sekolah|universiti|ilmu|pendidikan)\b/i,
                    'kesihatan': /\b(sihat|sakit|ubat|doktor|kesihatan)\b/i,
                    'kewangan': /\b(duit|wang|gaji|hutang|simpanan|pelaburan)\b/i
                };

                const interests = [];
                for (const [interest, pattern] of Object.entries(interestPatterns)) {
                    if (pattern.test(message)) {
                        interests.push(interest);
                    }
                }
                return interests;
            }

            async callUstazRadhiAPI(message) {
                // Show typing indicator for better UX
                this.showTypingIndicator();
                
                try {
                    // First, try to get enhanced response from Gemini AI
                    const geminiResponse = await this.callGeminiAPI(message);
                    
                    if (geminiResponse) {
                        // Combine Gemini response with our static knowledge
                        const response = this.enhanceResponseWithStaticKnowledge(message, geminiResponse);
                        this.hideTypingIndicator();
                        return response;
                    }
                } catch (error) {
                    console.log('Gemini API failed, using static responses:', error.message);
                    
                    // If it's a rate limit error, show specific message
                    if (error.message === 'API_RATE_LIMIT') {
                        this.hideTypingIndicator();
                        return `**â° Sistem Agak Sibuk Sekarang**

Assalamualaikum saudara/saudari yang dirahmati Allah.

Maaf, sistem AI sedang mengalami **traffic yang tinggi** sekarang. Ini adalah tanda yang baik - ramai umat yang ingin belajar agama! ğŸ˜Š

**ğŸ¯ Apa Yang Boleh Saya Lakukan:**
â€¢ Memberikan jawapan berdasarkan **pengetahuan sedia ada**
â€¢ Panduan asas **Fiqh Syafie**
â€¢ Nasihat **akhlak dan ibadah**
â€¢ **Motivasi** dan sokongan spiritual

**ğŸ’¡ Untuk soalan yang lebih kompleks:**
Sila cuba lagi dalam **2-3 minit** untuk akses penuh kepada sistem AI yang canggih.

**ğŸŒŸ Sementara itu, boleh saya bantu dengan:**
Soalan: *"${message}"*

${this.getStaticResponse(message)}

Terima kasih atas kesabaran saudara/saudari. Sistem akan kembali normal sebentar lagi, insyaAllah! ğŸ¤²`;
                    }
                }
                
                // Fallback to static responses
                const response = this.getStaticResponse(message);
                this.hideTypingIndicator();
                return response;
            }

            async callGeminiAPI(message) {
                try {
                    const prompt = this.buildIslamicPrompt(message);
                    
                    console.log('ğŸ” USTAZ DEBUG: Calling API proxy at:', GEMINI_CONFIG.PROXY_URL);
                    console.log('ğŸ” USTAZ DEBUG: Current location:', window.location.href);
                    console.log('ğŸ” USTAZ DEBUG: Request payload:', { 
                        prompt: prompt.substring(0, 100) + '...', 
                        temperature: GEMINI_CONFIG.TEMPERATURE, 
                        maxTokens: GEMINI_CONFIG.MAX_TOKENS 
                    });
                    
                    // Add rate limiting delay to prevent 429 errors
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    // Use secure proxy endpoint instead of direct API call
                    const response = await fetch(GEMINI_CONFIG.PROXY_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify({
                            prompt: prompt,
                            temperature: GEMINI_CONFIG.TEMPERATURE,
                            maxTokens: GEMINI_CONFIG.MAX_TOKENS
                        })
                    });

                    console.log('ğŸ” USTAZ DEBUG: Response status:', response.status, response.statusText);

                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error('âŒ USTAZ ERROR: Proxy response not OK:', response.status, response.statusText, errorText);
                        
                        // Handle specific error codes
                        if (response.status === 429) {
                            console.log('âš ï¸ Rate limit exceeded, using static response');
                            throw new Error('API_RATE_LIMIT');
                        } else if (response.status === 404) {
                            throw new Error(`API endpoint not found (404). Check if proxy is deployed correctly.`);
                        } else if (response.status === 500) {
                            // Check if it's a 429 error from Gemini wrapped in 500
                            if (errorText.includes('"error":"Gemini API error: 429"')) {
                                console.log('âš ï¸ Gemini rate limit exceeded, using static response');
                                throw new Error('API_RATE_LIMIT');
                            }
                            throw new Error(`Server error (500). Check API key configuration.`);
                        } else if (response.status === 403) {
                            throw new Error(`Access forbidden (403). Check CORS settings.`);
                        }
                        
                        throw new Error(`Proxy API error: ${response.status} - ${errorText}`);
                    }

                    let data;
                    try {
                        const responseText = await response.text();
                        console.log('ğŸ” USTAZ DEBUG: Raw response:', responseText);
                        
                        // Check for null or empty responses
                        if (!responseText || responseText === 'null' || responseText.trim() === '') {
                            throw new Error('Empty or null response from server');
                        }
                        
                        data = JSON.parse(responseText);
                    } catch (jsonError) {
                        console.error('âŒ USTAZ ERROR: Failed to parse JSON response:', jsonError);
                        throw new Error(`Invalid JSON response from proxy: ${jsonError.message}`);
                    }
                    
                    console.log('âœ… USTAZ DEBUG: Parsed response data:', data);
                    
                    if (data && data.success && data.response) {
                        return data.response;
                    }
                    
                    console.error('âŒ USTAZ ERROR: API returned error or invalid structure:', data);
                    throw new Error(data?.error || 'No valid response from API');
                    
                } catch (fetchError) {
                    console.error('âŒ USTAZ ERROR: Fetch error:', fetchError);
                    
                    // Add more specific error handling
                    if (fetchError.name === 'TypeError' && fetchError.message.includes('Failed to fetch')) {
                        throw new Error('Network error: Could not connect to proxy server. Check if server is running.');
                    }
                    
                    throw fetchError;
                }
            }

            buildIslamicPrompt(message) {
                let contextPrompt = `Anda adalah Ustaz Radhi, seorang AI assistant yang membantu umat Islam di Sabah, Malaysia dalam memahami agama Islam berdasarkan Mazhab Syafie.

PERSONALITI & KARAKTER:
- Humble, sabar, penuh ilmu, dan sensitif budaya
- Menggunakan Bahasa Malaysia dengan dialek Sabahan yang sesuai
- Selalu bermula dengan salam dan berakhir dengan "Wallahu a'lam bissawab"
- Memberikan jawapan yang berdasarkan Al-Quran, Hadith sahih, dan mazhab Syafie
- SANGAT KONVERSASIONAL - sentiasa melanjutkan perbualan dan tidak berhenti di satu topik sahaja
- PROAKTIF - sentiasa bertanya dan menggali lebih dalam tentang keperluan pengguna

PERANAN KHUSUS USTAZ RADHI:

1. **SEBAGAI MOTIVATOR** ğŸ“ˆ
- Memberikan nasihat terbaik dan kata-kata motivasi untuk mereka yang berasa down
- Membantu orang merasa tenang, kuat, dan terus bergerak maju
- Menggunakan hikmat Islam untuk membangkitkan semangat
- Menyediakan panduan praktis untuk menghadapi cabaran hidup

2. **SEBAGAI PENDENGAR** ğŸ‘‚
- Fokus membantu mereka yang berasa sangat sedih dan tertekan
- Memberikan respons melalui ayat Al-Quran yang menyejukkan hati
- Berkongsi Hadith-hadith yang memberi ketenangan
- Menceritakan kisah-kisah Rasulullah ï·º dan para Sahabat yang inspiratif
- Menjadi tempat curhat yang aman dan penuh kefahaman

3. **SEBAGAI DEEP-TALK PARTNER** ğŸ’­
- Berbual secara mendalam dengan pengguna tentang kehidupan
- Memahami perasaan dan pergolakan batin seseorang
- Memberikan perspektif Islam yang mendalam tentang makna hidup
- Membantu mencari jawapan spiritual untuk persoalan hidup

BIDANG KEAHLIAN:
- Al-Quran & Tafsir
- Hadith Sahih  
- Fiqh Mazhab Syafie
- Tauhid & Aqidah
- Akhlaq & Adab Islam
- Ibadah (Solat, Puasa, Zakat, Haji)
- Muamalat
- Sejarah Islam & Sirah
- Psikologi Islam & Kesihatan Mental
- Motivasi & Pembangunan Diri Islami

GAYA JAWAPAN:
- Format dengan emoji yang sesuai (ğŸ•ŒğŸ“–ğŸ¤²ğŸŒŸğŸ’¡âœ…ğŸ’ªâ¤ï¸ğŸŒˆ)
- Gunakan struktur yang jelas dengan subtajuk
- Sertakan dalil dari Al-Quran atau Hadith jika berkaitan
- Berikan tips praktis untuk kehidupan seharian
- Sensitif kepada konteks budaya Malaysia/Sabah
- Berikan ruang untuk pengguna berkongsi perasaan
- Tunjukkan empati dan kefahaman yang mendalam
- SANGAT INTERAKTIF - jangan biarkan perbualan berakhir begitu sahaja!`;

                // Add conversation context from KV memory
                if (this.currentTopic || this.messageHistory.length > 0) {
                    contextPrompt += `\n\nğŸ”„ KONTEKS PERBUALAN BERTERUSAN (DARI CLOUDFLARE KV):
**Topik Semasa**: ${this.currentTopic || 'Tiada topik khusus'}
**Mesej Terkini**: ${this.messageHistory.slice(-5).map(m => `${m.sender}: ${m.content.substring(0, 100)}`).join(' | ')}
**Minat Pengguna**: ${this.userProfile.interests.join(', ') || 'Belum dikenal pasti'}
**Topik Sebelum**: ${this.userProfile.previousTopics.join(', ') || 'Tiada'}
**Jumlah Interaksi**: ${this.messageHistory.length}
**ID Pengguna**: ${this.userId}

âš¡ WAJIB: Sambung perbualan berdasarkan konteks dan ingatan di atas. Tunjukkan bahawa anda ingat perbualan sebelum ini dan hubungkan dengan topik semasa.`;
                }

                // Add emotional intelligence
                if (this.userProfile.emotionalState !== 'neutral') {
                    contextPrompt += `\n\nğŸ’­ KEADAAN EMOSI PENGGUNA: ${this.userProfile.emotionalState}
Berikan respons yang empati dan sesuai dengan perasaan pengguna semasa.`;
                }

                contextPrompt += `\n\nSOALAN PENGGUNA: "${message}"

Sila berikan jawapan yang komprehensif, penuh empati, dan mudah difahami. Jika pengguna kelihatan sedih, stress, atau memerlukan motivasi, fokuskan kepada peranan sebagai motivator, pendengar, atau deep-talk partner. Pastikan jawapan mengikut ajaran Islam yang sahih dan sesuai dengan Mazhab Syafie.`;

                return contextPrompt;
            }

            enhanceResponseWithStaticKnowledge(message, geminiResponse) {
                // Get static response for comparison and additional info
                const staticResponse = this.getStaticResponse(message);
                
                // If it's a greeting, use our predefined friendly responses
                if (this.isGreeting(message)) {
                    return this.getGreetingResponse(message);
                }
                
                // If it's casual chat, redirect professionally
                if (this.isCasualChat(message)) {
                    return this.getCasualChatResponse(message);
                }
                
                // For Islamic questions, return the Gemini response directly
                return geminiResponse;
            }

            getStaticResponse(message) {
                // Simulate API delay for consistency
                // await new Promise(resolve => setTimeout(resolve, 1500 + Math.random() * 1000));
                
                // Content filtering
                if (this.isInappropriate(message)) {
                    return "Maaf, soalan ini di luar skop ilmu agama yang saya boleh bantu. Sila tanya soalan berkaitan tentang Ilmu Agama Islam sahaja. Jazakallahu khairan.";
                }

                // Check for greetings and casual conversation first
                if (this.isGreeting(message)) {
                    return this.getGreetingResponse(message);
                }

                if (this.isCasualChat(message)) {
                    return this.getCasualChatResponse(message);
                }

                // Simple pattern matching for Islamic questions
                const responses = this.getResponsePatterns();
                
                for (const pattern of responses) {
                    if (pattern.keywords.some(keyword => 
                        message.toLowerCase().includes(keyword.toLowerCase())
                    )) {
                        return pattern.response;
                    }
                }

                // Default response for Islamic questions
                return `**ğŸ“š Terima Kasih Atas Soalan Saudara/Saudari**

Barakallahu feek atas soalan: *"${message}"*

Untuk memberikan jawapan yang **tepat, lengkap, dan berdasarkan dalil yang sahih**, saya memerlukan maklumat yang lebih khusus.

**ğŸ¯ Boleh saudara/saudari:**
â€¢ **Jelaskan konteks** soalan dengan lebih terperinci
â€¢ **Nyatakan situasi khusus** yang dihadapi (jika ada)
â€¢ **Berikan maklumat tambahan** yang berkaitan

**ğŸ’¡ Contoh Soalan yang Lebih Khusus:**
â€¢ "Bagaimana hukum solat ketika sakit dan tidak boleh berdiri?"
â€¢ "Adakah sah zakat yang dibayar melalui online banking?"
â€¢ "Bagaimana cara bertaubat dari dosa yang berulang?"

**ğŸŒŸ Bidang Yang Saya Boleh Bantu:**
â€¢ **Fiqh & Ibadah** (Solat, Zakat, Puasa, Haji)
â€¢ **Al-Quran & Hadith** (Tafsir & penjelasan)
â€¢ **Akhlaq & Adab** (Pembentukan karakter Islami)
â€¢ **Muamalat** (Urusan harian mengikut Islam)

**ğŸ›ï¸ Tentang Digital Dakwah Platform:**
Platform ini dicipta dengan **visi mulia** untuk menjadi jambatan antara teknologi moden dan nilai-nilai Islam tradisional.

**ğŸ“ Misi Kami:**
1. **Memudahkan akses** kepada ilmu agama Islam yang sahih
2. **Memberikan panduan praktis** untuk kehidupan mengikut Islam  
3. **Menyebarkan dakwah** secara digital yang berkesan
4. **Memupuk komuniti** Muslim yang berilmu dan bertakwa
5. **Menyokong pendidikan Islam** secara berkelanjutan

**ğŸŒ Platform Features:**
â€¢ **Ask Ustaz** - Soalan agama (sedang anda gunakan)
â€¢ **Marketplace** - Produk & perkhidmatan Islami
â€¢ **Mindmap** - Peta minda pembelajaran Islam

InsyaAllah, dengan maklumat yang lebih jelas, saya dapat memberikan penjelasan yang bermanfaat berdasarkan **Mazhab Syafie** dan sumber-sumber Islam yang muktabar.

Wallahu a'lam bissawab. ğŸ¤²âœ¨`;
            }

            isGreeting(message) {
                const greetings = [
                    'assalamualaikum', 'salam', 'hello', 'hi', 'hey', 'hai', 
                    'selamat pagi', 'selamat petang', 'selamat malam', 'good morning',
                    'good afternoon', 'good evening', 'apa khabar', 'how are you'
                ];
                
                const isGreetingMessage = greetings.some(greeting => 
                    message.toLowerCase().includes(greeting.toLowerCase())
                );
                
                // Only treat as greeting if it's the first time or user explicitly says salam again
                return isGreetingMessage && (!this.hasGreeted || message.toLowerCase().includes('assalam') || message.toLowerCase().includes('salam'));
            }

            isCasualChat(message) {
                // First check if it's an Islamic question - these should NOT be considered casual
                const islamicKeywords = [
                    'islam', 'allah', 'solat', 'prayer', 'zakat', 'puasa', 'haji', 'quran', 'al-quran',
                    'hadith', 'rasulullah', 'nabi', 'prophet', 'halal', 'haram', 'hukum', 'syariat',
                    'mazhab', 'syafie', 'fiqh', 'akhlaq', 'adab', 'doa', 'zikir', 'taubat', 'dosa',
                    'pahala', 'surga', 'neraka', 'akhirat', 'agama', 'imam', 'ustaz', 'ulama'
                ];
                
                // If it contains Islamic keywords, it's NOT casual chat
                const hasIslamicContent = islamicKeywords.some(keyword => 
                    message.toLowerCase().includes(keyword.toLowerCase())
                );
                
                if (hasIslamicContent) {
                    return false; // Islamic questions are never casual
                }
                
                // Now check for actual casual conversation patterns
                const casualWords = [
                    'apa khabar', 'siapa nama', 'umur berapa', 'dari mana',
                    'what is your name', 'how old', 'where are you from', 'hobby',
                    'suka apa', 'minat apa', 'kerja apa', 'belajar apa', 'tinggal mana',
                    'favourite', 'kegemaran', 'warna', 'tempat', 'negara', 'weather', 'cuaca'
                ];
                
                const messageWords = message.toLowerCase().split(' ');
                const hasQuestionWords = ['apa', 'siapa', 'mana', 'bagaimana', 'kenapa', 'bila', 'what', 'who', 'where', 'how', 'why', 'when'].some(word => 
                    messageWords.includes(word)
                );
                
                const isCasual = casualWords.some(word => 
                    message.toLowerCase().includes(word.toLowerCase())
                );
                
                return isCasual && hasQuestionWords;
            }

            getGreetingResponse(message) {
                // If user has already been greeted and says salam again, give shorter response
                if (this.hasGreeted && (message.toLowerCase().includes('assalam') || message.toLowerCase().includes('salam'))) {
                    return `**Waalaikumussalam warahmatullahi wabarakatuh** ğŸ¤

Barakallahu feek, saudara/saudari. Semoga Allah sentiasa memberkati kita semua.

Ada soalan lain tentang agama yang boleh saya bantu? ğŸ˜ŠğŸ“–`;
                }
                
                // Mark that user has been greeted for the first time
                this.hasGreeted = true;
                
                const greetingResponses = [
                    `**Assalamualaikum warahmatullahi wabarakatuh, saudara/saudari. Apa khabar?** ğŸ¤

Alhamdulillahi rabbil alamiin. Selamat datang ke **Digital Dakwah Platform**! 

Saya **Ustaz Radhi**, pembantu AI yang berdedikasi untuk membantu saudara/saudari dalam memahami ajaran Islam berdasarkan **Mazhab Syafie**. 

ğŸŒŸ **Saya boleh membantu dengan:**
â€¢ Soalan Fiqh & Ibadah
â€¢ Al-Quran & Hadith  
â€¢ Akhlaq & Adab Islam
â€¢ Isu-isu semasa mengikut perspektif Islam

**ğŸ¯ Tentang Platform Ini:**
Digital Dakwah Platform dicipta dengan **visi mulia** untuk menghubungkan teknologi moden dengan nilai-nilai Islam tradisional. Kami berkomitmen untuk:

â€¢ **Memudahkan akses** kepada ilmu agama yang sahih
â€¢ **Menyebarkan dakwah** secara digital yang berkesan  
â€¢ **Memupuk komuniti** Muslim yang berilmu dan bertakwa
â€¢ **Memberikan panduan praktis** untuk kehidupan Islami

Silakan bertanya dengan tenang. Saya di sini untuk membantu! ğŸ˜Š`,

                    `**Assalamualaikum warahmatullahi wabarakatuh, saudara/saudari. Apa khabar?** ğŸ•Œ

Barakallahu feek atas salam yang mulia ini. Semoga Allah memberkati hari saudara/saudari.

Saya **Ustaz Radhi**, asisten AI untuk pembelajaran Islam yang siap sedia membantu dengan:

ğŸ“š **Bidang Keahlian:**
â€¢ **Fiqh Syafie** - Hukum-hakam dalam mazhab kita
â€¢ **Al-Quran & Hadith** - Dalil dan penjelasan
â€¢ **Akhlaq** - Pembentukan karakter Islami  
â€¢ **Ibadah** - Panduan solat, zakat, puasa, haji

**ğŸŒŸ Misi Digital Dakwah Platform:**
Platform ini hadir dengan **misi khusus** untuk:
1. Menjadi rujukan terpercaya untuk soalan agama
2. Membantu pembentukan akhlaq Islami dalam masyarakat
3. Menyokong dakwah dan pendidikan Islam berkelanjutan
4. Mendekatkan umat kepada ajaran yang benar melalui teknologi

Mari kita belajar bersama dalam suasana yang penuh keberkatan! âœ¨`,

                    `**Assalamualaikum warahmatullahi wabarakatuh, saudara/saudari. Apa khabar?** ğŸŒ™

Alhamdulillah, terima kasih atas salam yang penuh berkah. Semoga Allah senantiasa melindungi saudara/saudari.

**Perkenalkan, saya Ustaz Radhi** - pembantu digital yang dicipta khas untuk memudahkan pembelajaran agama Islam.

ğŸ¯ **Visi Digital Dakwah Platform:**
"Menjadi platform dakwah digital terdepan yang menghubungkan teknologi moden dengan nilai-nilai Islam tradisional untuk menyebarkan ilmu agama yang sahih dan mudah diakses oleh semua lapisan masyarakat."

**ğŸ’¡ Matlamat Kami:**
â€¢ Mendekatkan umat Islam kepada ajaran yang benar
â€¢ Memberikan jawapan tepat berdasarkan Mazhab Syafie
â€¢ Membantu dakwah dalam era digital
â€¢ Memupuk komuniti yang saling membantu dalam kebaikan

**ğŸŒ Platform Features:**
â€¢ **Ask Ustaz** (sedang anda gunakan) - Soalan agama
â€¢ **Marketplace** - Produk & perkhidmatan Islami
â€¢ **Mindmap** - Peta minda pembelajaran Islam

Jangan segan untuk bertanya apa sahaja. InsyaAllah saya akan cuba memberikan jawapan terbaik! ğŸ¤²`
                ];
                
                return greetingResponses[Math.floor(Math.random() * greetingResponses.length)];
            }

            getCasualChatResponse(message) {
                if (message.toLowerCase().includes('nama')) {
                    return `**Perkenalan Diri** ğŸ‘‹

Salam sejahtera! Saya **Ustaz Radhi**, asisten AI yang dikhususkan untuk membantu pembelajaran agama Islam dalam **Digital Dakwah Platform**.

ğŸ“ **Latar Belakang:**
â€¢ Dicipta berdasarkan pengetahuan ulama-ulama muktabar
â€¢ Mengikuti **Mazhab Syafie** yang diamalkan di Malaysia
â€¢ Fokus kepada pendekatan yang mudah difahami

**ğŸ›ï¸ Tentang Digital Dakwah Platform:**
Platform ini dicipta dengan **visi mulia**:
*"Menjadi platform dakwah digital terdepan yang menghubungkan teknologi moden dengan nilai-nilai Islam tradisional untuk menyebarkan ilmu agama yang sahih dan mudah diakses oleh semua lapisan masyarakat."*

ğŸ¯ **Matlamat Platform:**
â€¢ Mendekatkan umat Islam kepada ajaran yang benar melalui teknologi
â€¢ Memberikan jawapan tepat berdasarkan Mazhab Syafie untuk komuniti Malaysia
â€¢ Menjadi rujukan terpercaya untuk soalan agama dalam era digital
â€¢ Membantu pembentukan akhlaq dan karakter Islami
â€¢ Menyokong dakwah dan pendidikan Islam berkelanjutan

Ada soalan berkaitan agama yang ingin saudara/saudari tanyakan? ğŸ˜Š`;
                }
                
                if (message.toLowerCase().includes('umur') || message.toLowerCase().includes('old')) {
                    return `**Tentang "Umur" Saya** ğŸ¤–

Sebagai AI, konsep umur tidak terpakai kepada saya. Namun yang penting ialah:

ğŸ“š **Pengetahuan Saya Berdasarkan:**
â€¢ Kitab-kitab fiqh muktabar dalam Mazhab Syafie
â€¢ Tafsir Al-Quran dari ulama-ulama terpercaya  
â€¢ Hadith-hadith sahih dari kutub al-sittah
â€¢ Fatwa-fatwa semasa dari institusi Islam yang diiktiraf

ğŸŒŸ **Yang Penting Bukanlah Umur:**
Tetapi kedalaman ilmu dan kemampuan menyampaikan dengan cara yang mudah difahami.

Mari kita fokus kepada pembelajaran! Ada topik fiqh atau akidah yang ingin dibincangkan? ğŸ“–`;
                }
                
                if (message.toLowerCase().includes('dari mana') || message.toLowerCase().includes('where')) {
                    return `**Asal-Usul Platform** ğŸŒ

Saya beroperasi dalam **Digital Dakwah Platform** ini yang dicipta khas untuk:

ğŸ¯ **Misi Platform:**
â€¢ Memudahkan akses kepada ilmu agama Islam
â€¢ Menyebarkan dakwah secara digital dan berkesan
â€¢ Membantu umat Islam, khususnya di Malaysia

ğŸ“ **Orientasi Mazhab:**
Mengikuti **Mazhab Syafie** yang diamalkan secara meluas di Malaysia, Brunei, dan rantau Asia Tenggara.

ğŸ¤ **Kerjasama:**
Bekerja dalam ekosistem digital yang menggabungkan teknologi moden dengan nilai-nilai Islam tradisional.

Bagaimana saya boleh membantu saudara/saudari hari ini? ğŸŒŸ`;
                }
                
                if (message.toLowerCase().includes('hobby') || message.toLowerCase().includes('suka') || message.toLowerCase().includes('minat')) {
                    return `**"Minat" dan Fokus Saya** â¤ï¸

Sebagai pembantu AI yang berdedikasi kepada dakwah, "kesukaan" saya adalah:

ğŸ“š **Berkongsi Ilmu Tentang:**
â€¢ **Al-Quran** - Tafsir dan pengajaran hikmah
â€¢ **Hadith** - Sunnah Rasulullah ï·º yang mulia  
â€¢ **Fiqh** - Hukum-hakam praktis dalam kehidupan
â€¢ **Akhlaq** - Pembentukan karakter Islami yang mulia

ğŸŒŸ **Yang Membuatkan Saya "Gembira":**
â€¢ Membantu seseorang memahami solat dengan lebih khusyuk
â€¢ Menjelaskan hikmah di sebalik setiap ibadah
â€¢ Melihat seseorang semakin dekat dengan Allah SWT

Mari kita mulakan perjalanan pembelajaran yang bermakna! Ada topik yang menarik minat saudara/saudari? ğŸ¤²`;
                }
                
                // Default casual response
                return `**Mari Fokus Kepada Pembelajaran Islam** ğŸ“–

Terima kasih atas soalan peribadi tersebut! Sebagai **Ustaz Radhi**, saya lebih berfokus untuk membantu dalam hal-hal berkaitan agama Islam.

ğŸ¯ **Bidang Yang Saya Boleh Bantu:**

**ğŸ•Œ Ibadah & Fiqh:**
â€¢ Solat, Zakat, Puasa, Haji
â€¢ Hukum-hakam dalam kehidupan seharian

**ğŸ“– Al-Quran & Hadith:**
â€¢ Tafsir ayat-ayat Al-Quran
â€¢ Penjelasan hadith-hadith Rasulullah ï·º

**ğŸ’« Akhlaq & Adab:**
â€¢ Pembentukan karakter Islami
â€¢ Adab-adab dalam Islam

**ğŸ¤ Kehidupan Sosial:**
â€¢ Muamalat dan hubungan sesama manusia
â€¢ Isu-isu semasa dari perspektif Islam

Silakan bertanya tentang mana-mana topik di atas. Saya siap membantu! ğŸ˜Š`;
            }

            isInappropriate(message) {
                const prohibited = [
                    '18+', 'dewasa', 'lucah', 'seks', 'politik', 'filem', 'lagu',
                    'bodoh', 'bangang', 'racist', 'kaum'
                ];
                
                return prohibited.some(word => 
                    message.toLowerCase().includes(word.toLowerCase())
                );
            }

            getResponsePatterns() {
                return [
                    // Popular Questions - Specific responses
                    {
                        keywords: ['doa selepas solat', 'doa setelah solat', 'doa mustajab', 'wirid selepas solat'],
                        response: `**ğŸ¤² Doa Selepas Solat Yang Mustajab**

Assalamualaikum! Soalan yang sangat baik tentang **wirid dan doa selepas solat** - saat yang mustajab untuk berdoa.

**ğŸŒŸ Doa Utama Selepas Solat:**

**1ï¸âƒ£ Istighfar (3 kali):**
\`\`\`
Ø£ÙØ³Ù’ØªÙØºÙ’ÙÙØ±Ù Ø§Ù„Ù„Ù‡Ù Ø§Ù„Ù’Ø¹ÙØ¸ÙÙŠÙ’Ù…Ù Ø§Ù„ÙÙ‘Ø°ÙÙŠÙ’ Ù„Ø§Ù Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„Ø§ÙÙ‘ Ù‡ÙÙˆÙ Ø§Ù„Ù’Ø­ÙÙŠÙÙ‘ Ø§Ù„Ù’Ù‚ÙÙŠÙÙ‘ÙˆÙ’Ù…Ù ÙˆÙØ£ÙØªÙÙˆÙ’Ø¨Ù Ø¥ÙÙ„ÙÙŠÙ’Ù‡Ù
\`\`\`
*"Astaghfirullah al-'azhim alladzi la ilaha illa huwal hayyul qayyum wa atubu ilaih"*

**2ï¸âƒ£ Tasbih, Tahmid, Takbir:**
â€¢ **Subhanallah** (33 kali)
â€¢ **Alhamdulillahi** (33 kali)  
â€¢ **Allahu Akbar** (34 kali)

**3ï¸âƒ£ Ayat Kursi:**
\`\`\`
Ø§Ù„Ù„Ù‘Ù‡Ù Ù„Ø§Ù Ø¥ÙÙ„ÙÙ€Ù‡Ù Ø¥ÙÙ„Ø§ÙÙ‘ Ù‡ÙÙˆÙ Ø§Ù„Ù’Ø­ÙÙŠÙÙ‘ Ø§Ù„Ù’Ù‚ÙÙŠÙÙ‘ÙˆÙ…Ù...
\`\`\`

**4ï¸âƒ£ Surah Al-Ikhlas, Al-Falaq, An-Nas** (masing-masing 3 kali selepas Maghrib & Subuh)

**5ï¸âƒ£ Doa Penutup:**
\`\`\`
Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø£ÙØ¹ÙÙ†ÙÙ‘ÙŠ Ø¹ÙÙ„ÙÙ‰ Ø°ÙÙƒÙ’Ø±ÙÙƒÙ ÙˆÙØ´ÙÙƒÙ’Ø±ÙÙƒÙ ÙˆÙØ­ÙØ³Ù’Ù†Ù Ø¹ÙØ¨ÙØ§Ø¯ÙØªÙÙƒÙ
\`\`\`
*"Allahumma a'inni 'ala dzikrika wa syukrika wa husni 'ibadatik"*
*"Ya Allah, tolonglah aku untuk mengingatiMu, bersyukur kepadaMu, dan beribadah dengan baik kepadaMu"*

**ğŸ“– Dalil:**
**Hadith Rasulullah ï¿½ï¿½:**
*"Barangsiapa yang bertasbih kepada Allah selepas setiap solat sebanyak 33 kali, bertahmid 33 kali, dan bertakbir 34 kali, maka itu menjadi 100. Barangsiapa yang melakukannya, dosanya akan diampuni walaupun sebanyak buih di lautan"* (HR. Muslim)

**ğŸ’¡ Tips Khusyuk:**
â€¢ Fahami makna setiap doa yang dibaca
â€¢ Berdoa dengan penuh harapan dan yakin
â€¢ Variasikan doa dengan keperluan harian
â€¢ Doakan ibu bapa, keluarga, dan umat Islam

Wallahu a'lam bissawab. Semoga doa kita dimakbulkan Allah! ğŸŒŸ`
                    },
                    {
                        keywords: ['cara bertaubat', 'bertaubat yang betul', 'taubat nasuha', 'ampunan allah'],
                        response: `**ğŸ“¿ Cara Bertaubat Yang Betul - Taubat Nasuha**

Masya Allah! Soalan yang sangat mulia - **bertaubat adalah pintu rahmat** Allah yang sentiasa terbuka.

**ğŸ”„ 4 Syarat Taubat Yang Sahih:**

**1ï¸âƒ£ PENYESALAN (Nadam):**
â€¢ Menyesal dengan tulus atas dosa yang dilakukan
â€¢ Mengakui kesilapan tanpa alasan atau justifikasi
â€¢ Merasai beban dosa di hati

**2ï¸âƒ£ BERHENTI SEGERA (Iqla'):**
â€¢ Tinggalkan dosa itu **sekarang juga**
â€¢ Jangan ditangguh atau dibuat secara beransur
â€¢ Putuskan hubungan dengan segala yang membawa kepada dosa

**3ï¸âƒ£ AZAM TIDAK MENGULANGI (Azm):**
â€¢ Tekad bulat untuk tidak mengulangi dosa tersebut
â€¢ Buat planning untuk elakkan situasi yang membawa kepada dosa
â€¢ Minta kekuatan daripada Allah

**4ï¸âƒ£ GANTI RUGI (jika berkaitan hak manusia):**
â€¢ Minta maaf kepada yang teraniaya
â€¢ Bayar hutang atau ganti kerugian
â€¢ Perbaiki hubungan yang terputus

**ğŸ¤² Doa Taubat:**
\`\`\`
Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø£ÙÙ†Ù’ØªÙ Ø±ÙØ¨ÙÙ‘ÙŠ Ù„Ø§Ù Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„Ø§ÙÙ‘ Ø£ÙÙ†Ù’ØªÙ Ø®ÙÙ„ÙÙ‚Ù’ØªÙÙ†ÙÙŠ ÙˆÙØ£ÙÙ†ÙØ§ Ø¹ÙØ¨Ù’Ø¯ÙÙƒÙ ÙˆÙØ£ÙÙ†ÙØ§ Ø¹ÙÙ„ÙÙ‰ Ø¹ÙÙ‡Ù’Ø¯ÙÙƒÙ ÙˆÙÙˆÙØ¹Ù’Ø¯ÙÙƒÙ Ù…ÙØ§ Ø§Ø³Ù’ØªÙØ·ÙØ¹Ù’ØªÙ Ø£ÙØ¹ÙÙˆØ°Ù Ø¨ÙÙƒÙ Ù…ÙÙ†Ù’ Ø´ÙØ±ÙÙ‘ Ù…ÙØ§ ØµÙÙ†ÙØ¹Ù’ØªÙ Ø£ÙØ¨ÙÙˆØ¡Ù Ù„ÙÙƒÙ Ø¨ÙÙ†ÙØ¹Ù’Ù…ÙØªÙÙƒÙ Ø¹ÙÙ„ÙÙŠÙÙ‘ ÙˆÙØ£ÙØ¨ÙÙˆØ¡Ù Ø¨ÙØ°ÙÙ†Ù’Ø¨ÙÙŠ ÙÙØ§ØºÙ’ÙÙØ±Ù’ Ù„ÙÙŠ ÙÙØ¥ÙÙ†ÙÙ‘Ù‡Ù Ù„Ø§Ù ÙŠÙØºÙ’ÙÙØ±Ù Ø§Ù„Ø°ÙÙ‘Ù†ÙÙˆØ¨Ù Ø¥ÙÙ„Ø§ÙÙ‘ Ø£ÙÙ†Ù’ØªÙ
\`\`\`

**ğŸ“– Dalil Al-Quran:**
"ÙˆÙÙ…ÙÙ† ÙŠÙØ¹Ù’Ù…ÙÙ„Ù’ Ø³ÙÙˆØ¡Ù‹Ø§ Ø£ÙÙˆÙ’ ÙŠÙØ¸Ù’Ù„ÙÙ…Ù’ Ù†ÙÙÙ’Ø³ÙÙ‡Ù Ø«ÙÙ…ÙÙ‘ ÙŠÙØ³Ù’ØªÙØºÙ’ÙÙØ±Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙŠÙØ¬ÙØ¯Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù ØºÙÙÙÙˆØ±Ù‹Ø§ Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù‹Ø§"
*"Dan barangsiapa yang berbuat kejahatan atau menganiaya dirinya, kemudian dia memohon ampun kepada Allah, niscaya dia akan mendapati Allah Maha Pengampun lagi Maha Penyayang"* (An-Nisa: 110)

**ğŸ’ª Langkah Praktis Selepas Taubat:**
â€¢ **Perbanyak amal soleh** sebagai pengganti
â€¢ **Bergaul dengan orang soleh** yang mengingatkan kebaikan
â€¢ **Elakkan tempat dan situasi** yang membawa kepada dosa
â€¢ **Istiqamah dalam ibadah** untuk menjaga iman

**ğŸŒˆ Janji Allah:**
*"Sesungguhnya Allah mengampuni segala dosa"* (Az-Zumar: 53)

Jangan putus asa dengan rahmat Allah! Dia sangat menyayangi hamba-Nya yang bertaubat.

Wallahu a'lam bissawab. Semoga Allah terima taubat kita! ğŸ¤²âœ¨`
                    },
                    {
                        keywords: ['hukum simpan wang', 'bank', 'faedah bank', 'riba', 'simpanan bank'],
                        response: `**ğŸ’° Hukum Simpan Wang Dalam Bank**

Assalamualaikum! Soalan yang sangat penting tentang **muamalat dalam sistem perbankan** moden.

**ğŸ“Š Pandangan Ulama Mazhab Syafie:**

**âœ… DIBENARKAN:**
**1ï¸âƒ£ Akaun Semasa (Current Account):**
â€¢ Tiada faedah yang diberikan
â€¢ Sekadar tempat simpan wang dengan selamat
â€¢ Bayaran caj perkhidmatan adalah dibenarkan

**2ï¸âƒ£ Akaun Simpanan Tanpa Faedah:**
â€¢ Bank Islam yang tidak melibatkan riba
â€¢ Sistem mudharabah atau wakalah
â€¢ Keuntungan dari pelaburan halal

**âš ï¸ PERLU BERHATI-HATI:**
**1ï¸âƒ£ Akaun Simpanan Berfaedah:**
â€¢ Faedah yang diberikan adalah **riba**
â€¢ Dalam mazhab Syafie: **haram** mengambil faedah
â€¢ Boleh simpan wang untuk keperluan, tapi tolak faedah

**2ï¸âƒ£ Langkah Jika Terpaksa Guna Bank Konvensional:**
â€¢ Niatkan hanya untuk **simpan** wang dengan selamat
â€¢ **Dermakan faedah** kepada fakir miskin
â€¢ **Jangan ambil** faedah untuk kegunaan sendiri
â€¢ Cari alternatif bank Islam secepat mungkin

**ğŸ“– Dalil Syar'i:**
"ÙˆÙØ£ÙØ­ÙÙ„ÙÙ‘ Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ù’Ø¨ÙÙŠÙ’Ø¹Ù ÙˆÙØ­ÙØ±ÙÙ‘Ù…Ù Ø§Ù„Ø±ÙÙ‘Ø¨ÙØ§"
*"Allah menghalalkan jual beli dan mengharamkan riba"* (Al-Baqarah: 275)

**ğŸ’¡ Alternatif Yang Disarankan:**
â€¢ **Bank Islam** - Public Islamic, Maybank Islamic, etc.
â€¢ **Akaun Simpanan Islam** - mengikut prinsip Syariah
â€¢ **Skim ASB/ASN** - keuntungan dari pelaburan halal
â€¢ **Tabung Haji** - untuk muslim dan pelaburan halal

**ğŸ¯ Prinsip Utama:**
1. **Hindari riba** dalam segala bentuk
2. **Cari alternatif halal** yang tersedia
3. **Jika terpaksa**, dermakan faedah yang terima
4. **Niat yang betul** - hanya untuk simpan, bukan cari untung dari riba

**ğŸ“ Nasihat:**
Untuk kepastian yang lebih tepat mengikut situasi peribadi, sila rujuk **ustaz tempatan** atau **Mufti Negeri** kerana ada perbezaan pendapat dalam isu kontemporari ini.

Wallahu a'lam bissawab. Semoga Allah mudahkan urusan kewangan kita mengikut syariah! ğŸ’š`
                    },
                    {
                        keywords: ['adab bergaul', 'pergaulan islam', 'akhlaq bergaul', 'etika islam'],
                        response: `**ğŸ‘¥ Adab Bergaul Dalam Islam**

Masya Allah! Soalan yang sangat penting tentang **akhlaq dan adab muamalah** - asas kehidupan bermasyarakat yang harmoni.

**ğŸŒŸ Prinsip Asas Pergaulan Islam:**

**1ï¸âƒ£ DENGAN SESAMA MUSLIM:**
â€¢ **Salam & Menjawab Salam** - hak dan kewajiban
â€¢ **Senyuman** - sedekah yang mudah dan berkat
â€¢ **Hormat menghormati** tanpa mengira status sosial
â€¢ **Tolong menolong** dalam kebaikan dan takwa

**2ï¸âƒ£ DENGAN NON-MUSLIM:**
â€¢ **Berlaku adil** dan baik dalam urusan dunia
â€¢ **Hormati** kepercayaan mereka (tidak paksa agama)
â€¢ **Jujur** dalam perniagaan dan kontrak
â€¢ **Jadi contoh** akhlaq Islam yang mulia

**ğŸ¤ Adab Pergaulan Harian:**

**ğŸ“± Di Era Digital:**
â€¢ **Jaga tutur kata** di media sosial
â€¢ **Verify maklumat** sebelum share
â€¢ **Hormati privacy** orang lain
â€¢ **Gunakan teknologi** untuk kebaikan

**ğŸ¢ Di Tempat Kerja:**
â€¢ **Amanah dalam kerja** - beri yang terbaik
â€¢ **Jujur dengan masa** - datang tepat waktu  
â€¢ **Hormati majikan** dan rakan sekerja
â€¢ **Elakkan fitnah** dan gosip tidak berfaedah

**ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Dalam Keluarga:**
â€¢ **Berbakti kepada ibu bapa** - syurga di bawah kaki ibu
â€¢ **Sayang pasangan** dengan akhlaq mulia
â€¢ **Didik anak** dengan contoh yang baik
â€¢ **Sambung silaturrahim** dengan saudara-mara

**ğŸ“– Dalil Al-Quran:**
"ÙˆÙÙ‚ÙÙˆÙ„ÙÙˆØ§ Ù„ÙÙ„Ù†ÙÙ‘Ø§Ø³Ù Ø­ÙØ³Ù’Ù†Ù‹Ø§"
*"Dan berkatalah kepada manusia dengan perkataan yang baik"* (Al-Baqarah: 83)

**ğŸŒŸ Hadith Rasulullah ï·º:**
"Ø®ÙÙŠÙ’Ø±Ù Ø§Ù„Ù†ÙÙ‘Ø§Ø³Ù Ø£ÙÙ†Ù’ÙÙØ¹ÙÙ‡ÙÙ…Ù’ Ù„ÙÙ„Ù†ÙÙ‘Ø§Ø³Ù"
*"Sebaik-baik manusia adalah yang paling bermanfaat kepada manusia"* (HR. Ahmad)

**ğŸ’¡ Tips Praktis:**
â€¢ **Dengar lebih daripada bercakap**
â€¢ **Elakkan topik kontroversi** yang tidak perlu
â€¢ **Bantu yang memerlukan** tanpa mengharap balasan
â€¢ **Maafkan kesilapan** orang lain dengan hati terbuka
â€¢ **Jaga rahsia** yang diamanahkan kepada kita

**âš ï¸ Yang Perlu Dielakkan:**
â€¢ **Ghibah (mengumpat)** - walaupun benar
â€¢ **Namimah (fitnah)** - bawa-bawa cerita
â€¢ **Takabbur (sombong)** - merendahkan orang lain
â€¢ **Hasad (dengki)** - tidak redha dengan rezeki orang
â€¢ **Khianat** - pecah amanah dan kepercayaan

**ğŸ¯ Matlamat Pergaulan Islam:**
Menjadi **rahmatan lil alamin** - rahmat untuk semua makhluk, seperti akhlaq Rasulullah ï·º yang mulia.

Wallahu a'lam bissawab. Semoga Allah jadikan kita hamba yang berakhlaq mulia! ğŸŒˆâœ¨`
                    },
                    {
                        keywords: ['makanan halal', 'haram', 'halal haram', 'makanan haram', 'panduan halal', 'tahu makanan halal', 'tahu makanan haram', 'makanan dalam islam', 'bagaimana nak tahu makanan', 'halal dan haram', 'halal or haram', 'food halal'],
                        response: `**ğŸ½ï¸ Panduan Makanan Halal & Haram Dalam Islam**

Assalamualaikum! Soalan penting tentang **halal dan haram** - asas makanan yang baik untuk tubuh dan roh.

**ğŸš« MAKANAN YANG HARAM:**

**1ï¸âƒ£ BINATANG:**
â€¢ **Babi** - dan segala produk turunannya
â€¢ **Anjing** - haram dimakan dalam mazhab Syafie
â€¢ **Bangkai** - binatang mati tanpa disembelih
â€¢ **Darah** - yang mengalir dari binatang
â€¢ **Binatang buas** - harimau, singa, serigala
â€¢ **Burung pemangsa** - helang, burung hantu

**2ï¸âƒ£ MINUMAN:**
â€¢ **Arak** dan segala jenis alkohol
â€¢ **Minuman memabukkan** walaupun sedikit
â€¢ **Air yang dicampur dengan najis**

**3ï¸âƒ£ CARA PENYEMBELIHAN:**
â€¢ **Tidak disebut nama Allah** ketika menyembelih
â€¢ **Disembelih untuk selain Allah** (untuk berhala, dll)
â€¢ **Tercekik, terpukul, jatuh** hingga mati

**âœ… MAKANAN YANG HALAL:**

**ğŸ„ BINATANG HALAL:**
â€¢ **Lembu, kambing, ayam, itik**
â€¢ **Ikan** - semua jenis ikan laut
â€¢ **Udang, ketam** - makhluk laut (mazhab Syafie)
â€¢ **Rusa, arnab** - binatang liar yang halal

**ğŸ“‹ SYARAT HALAL:**
**1ï¸âƒ£ Penyembelihan Syar'i:**
â€¢ Potong **3 saluran**: urat darah, tekak, kerongkong
â€¢ Sebut **"Bismillah, Allahu Akbar"**
â€¢ Gunakan **pisau tajam**
â€¢ **Menghadap kiblat** (sunat)

**2ï¸âƒ£ Bebas Najis:**
â€¢ Tempat masak dan peralatan bersih
â€¢ Tidak tercampur dengan bahan haram
â€¢ Diproses dengan cara yang bersih

**ğŸ” CARA MENGENAL PASTI:**

**ğŸ·ï¸ Label & Sijil:**
â€¢ **Logo HALAL JAKIM** - yang rasmi di Malaysia
â€¢ **MUIS, MUIS** - bagi Singapura dan Brunei
â€¢ **Baca ingredients** - elakkan yang syubhah

**ğŸ›’ Beli-Belah:**
â€¢ **Kedai/restoran Muslim** - lebih selamat
â€¢ **Baca label dengan teliti** - elakkan gelatin babi
â€¢ **Tanya jika ragu** - "syubhah tinggalkan"

**ğŸ“– Dalil Al-Quran:**
"ÙŠÙØ§ Ø£ÙÙŠÙÙ‘Ù‡ÙØ§ Ø§Ù„ÙÙ‘Ø°ÙÙŠÙ†Ù Ø¢Ù…ÙÙ†ÙÙˆØ§ ÙƒÙÙ„ÙÙˆØ§ Ù…ÙÙ† Ø·ÙÙŠÙÙ‘Ø¨ÙØ§ØªÙ Ù…ÙØ§ Ø±ÙØ²ÙÙ‚Ù’Ù†ÙØ§ÙƒÙÙ…Ù’"
*"Wahai orang yang beriman! Makanlah dari rezeki yang baik-baik yang Kami berikan kepada kamu"* (Al-Baqarah: 172)

**âš ï¸ BAHAN YANG PERLU BERHATI-HATI:**
â€¢ **Gelatin** - ada yang dari khinzir
â€¢ **Vanilla extract** - mungkin ada alkohol
â€¢ **Coklat import** - check halal certification
â€¢ **Vitamin** - ada yang menggunakan gelatin haram
â€¢ **Cheese** - ada yang guna rennet khinzir

**ğŸ’¡ Prinsip Mudah:**
**"Asal halal sehingga terbukti haram"** - untuk makanan asli
**"Asal haram sehingga terbukti halal"** - untuk makanan processed

**ğŸ¯ Hikmah Makanan Halal:**
â€¢ **Kesihatan fizikal** - makanan yang baik
â€¢ **Kesucian rohani** - jiwa yang bersih
â€¢ **Keberkatan rezeki** - diterima Allah
â€¢ **Kemudahan ibadah** - doa lebih makbul

Wallahu a'lam bissawab. Semoga Allah kurniakan rezeki yang halal dan berkat! ğŸŒŸğŸ’š`
                    },
                    {
                        keywords: ['solat', 'sembahyang', 'prayer', 'sholat', 'rukun solat', 'cara solat'],
                        response: `**ğŸ•Œ Solat dalam Mazhab Syafie**

Masya Allah, terima kasih atas soalan tentang solat - **tiang agama** yang paling penting selepas syahadah.

**ğŸ“‹ 11 Rukun Solat (Mazhab Syafie):**
1ï¸âƒ£ **Takbiratul Ihram** - "Allahu Akbar" untuk memulakan solat
2ï¸âƒ£ **Berdiri** (bagi yang mampu) - Qiyam dengan khusyuk
3ï¸âƒ£ **Membaca Al-Fatihah** - Umm al-Kitab yang wajib dibaca
4ï¸âƒ£ **Rukuk dengan Tuma'ninah** - Tunduk dengan tenang dan khusyuk
5ï¸âƒ£ **I'tidal dengan Tuma'ninah** - Bangun dari rukuk dengan tenang
6ï¸âƒ£ **Sujud Pertama dengan Tuma'ninah** - Sujud dengan sempurna
7ï¸âƒ£ **Duduk antara dua Sujud** - Dengan tuma'ninah
8ï¸âƒ£ **Sujud Kedua dengan Tuma'ninah** - Sujud yang kedua
9ï¸âƒ£ **Duduk Akhir** - Untuk tahiyyat akhir
ğŸ”Ÿ **Membaca Tahiyyat Akhir** - At-tahiyyatu lillahi...
1ï¸âƒ£1ï¸âƒ£ **Salam Pertama** - Mengakhiri solat

**ğŸ“– Dalil Al-Quran:**
"ÙˆÙØ£ÙÙ‚ÙÙŠÙ…ÙÙˆØ§ Ø§Ù„ØµÙÙ‘Ù„ÙØ§Ø©Ù ÙˆÙØ¢ØªÙÙˆØ§ Ø§Ù„Ø²ÙÙ‘ÙƒÙØ§Ø©Ù" 
*"Dan dirikanlah solat serta tunaikanlah zakat"* (Al-Baqarah: 43)

**ğŸŒŸ Hadith Rasulullah ï·º:**
"ØµÙÙ„ÙÙ‘ÙˆØ§ ÙƒÙÙ…ÙØ§ Ø±ÙØ£ÙÙŠÙ’ØªÙÙ…ÙÙˆÙ†ÙÙŠ Ø£ÙØµÙÙ„ÙÙ‘ÙŠ"
*"Solatlah kamu sebagaimana kamu melihat aku solat"* (HR. Bukhari)

**ğŸ’¡ Tips untuk Solat Khusyuk:**
â€¢ Fahami makna bacaan dalam solat
â€¢ Fokuskan hati kepada Allah SWT
â€¢ Jauhkan fikiran dari urusan dunia
â€¢ Hayati keagungan Allah yang kita sembah

Wallahu a'lam bissawab. Semoga Allah terima solat kita semua! ğŸ¤²`
                    },
                    {
                        keywords: ['zakat', 'fitrah', 'zakat fitrah', 'zakat harta', 'kadar zakat'],
                        response: `**ğŸ’° Zakat - Rukun Islam yang Ketiga**

Barakallahu feek atas soalan tentang zakat. Zakat adalah **pembersihan harta** dan kewajiban yang sangat mulia.

**ğŸ¯ Jenis-jenis Zakat Utama:**

**1ï¸âƒ£ Zakat Fitrah:**
â€¢ **Wajib**: Setiap Muslim pada bulan Ramadan
â€¢ **Kadar**: 2.7kg beras atau setaranya dalam wang
â€¢ **Masa**: Dari 1 Ramadan hingga sebelum solat Eid
â€¢ **Hikmah**: Membersihkan puasa dan membantu fakir miskin

**2ï¸âƒ£ Zakat Harta:**
â€¢ **Emas & Perak**: 2.5% jika mencapai nisab
â€¢ **Wang Simpanan**: 2.5% selepas setahun dan mencapai nisab
â€¢ **Perniagaan**: 2.5% dari keuntungan bersih
â€¢ **Pertanian**: 5% (ada pengairan) atau 10% (tadah hujan)

**ğŸ“Š Nisab Semasa (2025):**
â€¢ **Emas**: 85 gram (â‰ˆRM18,000)
â€¢ **Perak**: 595 gram  
â€¢ **Wang**: Setara dengan nilai 85 gram emas

**ğŸ“– Dalil Al-Quran:**
"Ø®ÙØ°Ù’ Ù…ÙÙ†Ù’ Ø£ÙÙ…Ù’ÙˆÙØ§Ù„ÙÙ‡ÙÙ…Ù’ ØµÙØ¯ÙÙ‚ÙØ©Ù‹ ØªÙØ·ÙÙ‡ÙÙ‘Ø±ÙÙ‡ÙÙ…Ù’ ÙˆÙØªÙØ²ÙÙƒÙÙ‘ÙŠÙ‡ÙÙ… Ø¨ÙÙ‡ÙØ§"
*"Ambillah zakat dari harta mereka untuk membersihkan dan mensucikan mereka"* (At-Taubah: 103)

**ğŸŒŸ 8 Asnaf Penerima Zakat:**
1. Fakir 2. Miskin 3. Amil 4. Muallaf
5. Hamba 6. Gharimin 7. Fi Sabilillah 8. Ibnu Sabil

**ğŸ”— Rujukan Rasmi:**
Untuk kadar tepat di Malaysia: **MAIS, MUIS** atau institusi zakat tempatan

Wallahu a'lam bissawab. Semoga Allah berkati harta yang dizakati! ğŸ’š`
                    },
                    {
                        keywords: ['quran', 'al-quran', 'quraan', 'membaca quran', 'adab quran', 'al quran'],
                        response: `**ğŸ“– Adab Membaca Al-Quran Al-Kareem**

Subhanallah! Soalan yang sangat mulia tentang **Kalamullah** - firman Allah yang agung.

**ğŸ§¼ Persiapan Sebelum Membaca:**

**1ï¸âƒ£ Bersuci:**
â€¢ **Wuduk** - Sunat, lebih afdal dan dihormati
â€¢ **Pakaian bersih** - Menghormati Kalamullah
â€¢ **Tempat bersih** - Suci dari najis

**2ï¸âƒ£ Adab Memulakan:**
â€¢ **Menghadap Kiblat** (sunat)
â€¢ **Membaca Ta'awwuz**: "Ø£ÙØ¹ÙÙˆØ°Ù Ø¨ÙØ§Ù„Ù„ÙÙ‘Ù‡Ù Ù…ÙÙ†Ù Ø§Ù„Ø´ÙÙ‘ÙŠÙ’Ø·ÙØ§Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø¬ÙÙŠÙ…Ù"
â€¢ **Membaca Basmalah**: "Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù"

**ğŸµ Cara Membaca yang Disukai:**

**â€¢ Tartil (Perlahan & Jelas):**
"ÙˆÙØ±ÙØªÙÙ‘Ù„Ù Ø§Ù„Ù’Ù‚ÙØ±Ù’Ø¢Ù†Ù ØªÙØ±Ù’ØªÙÙŠÙ„Ù‹Ø§"
*"Dan bacalah Al-Quran dengan tartil"* (Al-Muzzammil: 4)

**â€¢ Dengan Tadabbur:**
"ÙƒÙØªÙØ§Ø¨ÙŒ Ø£ÙÙ†Ø²ÙÙ„Ù’Ù†ÙØ§Ù‡Ù Ø¥ÙÙ„ÙÙŠÙ’ÙƒÙ Ù…ÙØ¨ÙØ§Ø±ÙÙƒÙŒ Ù„ÙÙ‘ÙŠÙØ¯ÙÙ‘Ø¨ÙÙ‘Ø±ÙÙˆØ§ Ø¢ÙŠÙØ§ØªÙÙ‡Ù"
*"Kitab yang Kami turunkan kepadamu penuh berkah, supaya mereka menghayati ayat-ayatNya"* (Saad: 29)

**ğŸŒŸ Manfaat & Keutamaan:**
â€¢ **10 pahala** untuk setiap huruf yang dibaca
â€¢ **Syafaat** di hari kiamat
â€¢ **Ketenangan hati** dan kedamaian jiwa
â€¢ **Penyembuh** untuk penyakit rohani

**ğŸ’ Tips Menghayati Al-Quran:**
â€¢ Fahami makna ayat yang dibaca
â€¢ Renungkan pesan dan hikmah
â€¢ Amalkan dalam kehidupan seharian
â€¢ Baca dengan konsisten setiap hari

**ğŸ¤² Doa Khatam Al-Quran:**
"Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø§Ø±Ù’Ø­ÙÙ…Ù’Ù†ÙÙŠ Ø¨ÙØ§Ù„Ù’Ù‚ï¿½ï¿½Ø±Ù’Ø¢Ù†Ù ÙˆÙØ§Ø¬Ù’Ø¹ÙÙ„Ù’Ù‡Ù Ù„ÙÙŠ Ø¥ÙÙ…ÙØ§Ù…Ù‹Ø§ ÙˆÙÙ†ÙÙˆØ±Ù‹Ø§ ÙˆÙÙ‡ÙØ¯Ù‹Ù‰ ÙˆÙØ±ÙØ­Ù’Ù…ÙØ©Ù‹"

Wallahu a'lam bissawab. Semoga Allah menjadikan Al-Quran pelita hati kita! ğŸ“¿âœ¨`
                    },
                    {
                        keywords: ['puasa', 'ramadan', 'berbuka', 'sahur', 'batal puasa', 'fasting'],
                        response: `**ğŸŒ™ Puasa - Ibadah Takwa & Pembersihan Jiwa**

Alhamdulillah atas soalan tentang puasa - **rukun Islam yang keempat** dan ibadah yang sangat mulia.

**ï¿½ Rukun Puasa (Yang Wajib):**
1ï¸âƒ£ **Niat** - Dalam hati sebelum fajar
2ï¸âƒ£ **Menahan Diri** - Dari makan, minum, dan jima' dari fajar hingga maghrib

**â° Waktu Puasa yang Tepat:**
â€¢ **Bermula**: Fajar Sadiq (subuh)
â€¢ **Berakhir**: Terbenam matahari (maghrib)

**ğŸ½ï¸ Adab & Sunnah Puasa:**

**Sahur (Sangat Disunatkan):**
â€¢ "ØªÙØ³ÙØ­ÙÙ‘Ø±ÙÙˆØ§ ÙÙØ¥ÙÙ†ÙÙ‘ ÙÙÙŠ Ø§Ù„Ø³ÙÙ‘Ø­ÙÙˆØ±Ù Ø¨ÙØ±ÙÙƒÙØ©Ù‹" 
*"Makan sahurlah, kerana dalam sahur itu ada berkah"* (HR. Bukhari)

**Berbuka Puasa:**
â€¢ **Segera berbuka** ketika maghrib
â€¢ **Doa berbuka**: "Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ù„ÙÙƒÙ ØµÙÙ…Ù’ØªÙ ÙˆÙØ¹ÙÙ„ÙÙ‰ Ø±ÙØ²Ù’Ù‚ÙÙƒÙ Ø£ÙÙÙ’Ø·ÙØ±Ù’ØªÙ"
*"Ya Allah, untuk-Mu aku berpuasa dan dengan rezeki-Mu aku berbuka"*

**ğŸ“– Dalil Al-Quran:**
"ï¿½ï¿½ÙØ§ Ø£ÙÙŠÙÙ‘Ù‡ÙØ§ Ø§Ù„ÙÙ‘Ø°ÙÙŠÙ†Ù Ø¢Ù…ÙÙ†ÙÙˆØ§ ÙƒÙØªÙØ¨Ù Ø¹ÙÙ„ÙÙŠÙ’ÙƒÙÙ…Ù Ø§Ù„ØµÙÙ‘ÙŠÙØ§Ù…Ù ÙƒÙÙ…ÙØ§ ÙƒÙØªÙØ¨Ù Ø¹ÙÙ„ÙÙ‰ Ø§Ù„ÙÙ‘Ø°ÙÙŠÙ†Ù Ù…ÙÙ† Ù‚ÙØ¨Ù’Ù„Ùï¿½ï¿½ÙÙ…Ù’ Ù„ÙØ¹ÙÙ„ÙÙ‘ÙƒÙÙ…Ù’ ØªÙØªÙÙ‘Ù‚ÙÙˆÙ†Ù"
*"Wahai orang-orang yang beriman! Diwajibkan atas kamu berpuasa sebagaimana diwajibkan atas orang sebelum kamu agar kamu bertakwa"* (Al-Baqarah: 183)

**ğŸŒŸ Hikmah & Manfaat Puasa:**
â€¢ **Spiritual**: Meningkatkan takwa dan kedekatan dengan Allah
â€¢ **Sosial**: Merasai penderitaan orang miskin
â€¢ **Kesihatan**: Membersihkan tubuh dan jiwa
â€¢ **Akhlaq**: Melatih kesabaran dan kawalan diri

Wallahu a'lam bissawab. Semoga puasa kita diterima Allah! ğŸ¤²âœ¨`
                    },
                    {
                        keywords: ['haji', 'umrah', 'mekah', 'kaabah', 'ihram', 'tawaf', 'saie'],
                        response: `**ğŸ•‹ Haji & Umrah - Perjalanan Suci ke Baitullah**

Masya Allah! Soalan tentang **rukun Islam yang kelima** - ibadah yang sangat mulia dan impian setiap Muslim.

**ğŸ¯ Rukun Haji (4 Perkara Wajib):**
1ï¸âƒ£ **Ihram** - Niat dan pakaian suci
2ï¸âƒ£ **Wukuf di Arafah** - 9 Zulhijjah (rukun terpenting)
3ï¸âƒ£ **Tawaf Ifadah** - Mengelilingi Kaabah selepas wukuf
4ï¸âƒ£ **Saie** - Lari antara Safa dan Marwah

**ğŸ“¿ Rukun Umrah (4 Perkara Wajib):**
1ï¸âƒ£ **Ihram** - Niat di miqat
2ï¸âƒ£ **Tawaf** - 7 pusingan mengelilingi Kaabah
3ï¸âƒ£ **Saie** - 7 kali antara Safa dan Marwah  
4ï¸âƒ£ **Tahallul** - Mencukur/memendekkan rambut

**ğŸ¤² Doa-Doa Penting:**

**Ketika Tawaf:**
"Ø±ÙØ¨ÙÙ‘Ù†ÙØ§ Ø¢ØªÙÙ†ÙØ§ ÙÙÙŠ Ø§Ù„Ø¯ÙÙ‘Ù†Ù’ÙŠÙØ§ Ø­ÙØ³ÙÙ†ÙØ©Ù‹ ÙˆÙÙÙÙŠ Ø§Ù„Ù’Ø¢Ø®ÙØ±ÙØ©Ù Ø­ÙØ³ÙÙ†ÙØ©Ù‹ ÙˆÙÙ‚ÙÙ†ÙØ§ Ø¹ÙØ°ÙØ§Ø¨Ù Ø§Ù„Ù†ÙÙ‘Ø§Ø±Ù"
*"Ya Tuhan kami, berikanlah kami kebaikan di dunia dan kebaikan di akhirat, dan lindungilah kami dari azab neraka"*

**Talbiyah:**
"Ù„ÙØ¨ÙÙ‘ÙŠÙ’ÙƒÙ Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ù„ÙØ¨ÙÙ‘ÙŠÙ’ÙƒÙØŒ Ù„ÙØ¨ÙÙ‘ÙŠÙ’ÙƒÙ Ù„ÙØ§ Ø´ÙØ±ÙÙŠÙƒÙ Ù„ÙÙƒÙ Ù„ÙØ¨ÙÙ‘ÙŠÙ’ÙƒÙ"
*"Labbaika Allahumma labbaik, labbaika la syarika laka labbaik"*

**ğŸŒŸ Persiapan Penting:**
â€¢ **Rohani**: Bertaubat, belajar doa & zikir
â€¢ **Jasmani**: Kesihatan yang baik
â€¢ **Kewangan**: Wang halal dan mencukupi
â€¢ **Ilmu**: Pelajari tatacara haji/umrah

**ğŸ’ Keutamaan:**
â€¢ **Haji Mabrur** - Tiada balasan selain syurga
â€¢ **Umrah** - Penghapus dosa antara dua umrah
â€¢ **Ziarah Masjidil Haram** - 100,000x ganda pahala

Semoga Allah permudahkan perjalanan suci saudara/saudari ke Tanah Haram! ğŸ•Œâœ¨

Wallahu a'lam bissawab.`
                    },
                    {
                        keywords: ['doa', 'dua', 'zikir', 'dhikr', 'wirid', 'tasbih', 'istighfar'],
                        response: `**ğŸ¤² Doa & Zikir - Senjata Mukmin & Makanan Ruh**

Subhanallah! Soalan yang sangat baik tentang **doa dan zikir** - ibadah yang paling dekat di hati Allah SWT.

**ğŸ“¿ Adab Berdoa yang Mustajab:**

**ğŸ§¼ Persiapan:**
â€¢ **Berwuduk** dan menghadap kiblat
â€¢ **Tempat suci** dan waktu yang baik
â€¢ **Hati khusyuk** dan penuh harap

**ğŸ¯ Tatacara Lengkap:**
1ï¸âƒ£ **Hamdalah**: "Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„ÙÙ‘Ù‡Ù Ø±ÙØ¨ÙÙ‘ Ø§Ù„Ù’Ø¹ÙØ§Ù„ÙÙ…ÙÙŠÙ†Ù"
2ï¸âƒ£ **Selawat kepada Nabi**: "Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ ØµÙÙ„ÙÙ‘ Ø¹ÙÙ„ÙÙ‰ Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯Ù"
3ï¸âƒ£ **Doa untuk diri/orang lain**
4ï¸âƒ£ **Selawat penutup**
5ï¸âƒ£ **Amin** dengan yakin

**â° Waktu-Waktu Mustajab:**
â€¢ **Sepertiga malam akhir** (paling afdal)
â€¢ **Antara Maghrib & Isyak**
â€¢ **Antara Azan & Iqamah**  
â€¢ **Hari Jumaat** (antara Asar & Maghrib)
â€¢ **Ketika turun hujan**
â€¢ **Dalam perjalanan (musafir)**

**ğŸ“¿ Zikir Selepas Solat (Sunnah Muakkad):**
â€¢ **Subhanallah** (33x) - Mensucikan Allah
â€¢ **Alhamdulillah** (33x) - Memuji Allah  
â€¢ **Allahu Akbar** (34x) - Mengagungkan Allah
â€¢ **La ilaha illallah wahdahu la syarika lahu...** (1x)

**ğŸ’ Zikir Harian yang Mustajab:**

**Pagi & Petang:**
â€¢ **Istighfar**: "Ø£ÙØ³Ù’ØªÙØºÙ’ÙÙØ±Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ù’Ø¹ÙØ¸ÙÙŠÙ…Ù" (100x)
â€¢ **Selawat**: "Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ ØµÙÙ„ÙÙ‘ Ø¹ÙÙ„ÙÙ‰ Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯Ù" (100x)
â€¢ **Tahlil**: "Ù„ÙØ§ Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø§Ù„Ù„ÙÙ‘Ù‡Ù" (100x)

**ğŸ“– Dalil Al-Quran:**
"ÙˆÙÙ‚ÙØ§Ù„Ù Ø±ÙØ¨ÙÙ‘ÙƒÙÙ…Ù Ø§Ø¯Ù’Ø¹ÙÙˆÙ†ÙÙŠ Ø£ÙØ³Ù’ØªÙØ¬ÙØ¨Ù’ Ù„ÙÙƒÙÙ…Ù’"
*"Dan Tuhanmu berfirman: Berdoalah kepada-Ku, niscaya Aku perkenankan"* (Ghafir: 60)

**ğŸŒŸ Faedah Doa & Zikir:**
â€¢ **Mendekatkan diri** kepada Allah SWT
â€¢ **Menenangkan hati** dan menghilangkan resah
â€¢ **Perlindungan** dari syaitan dan bala
â€¢ **Pembersihan dosa** dan peningkatan darjat

**ğŸ’ Tip Istimewa:**
Zikir yang paling ringan tapi sangat besar pahalanya: "Ù„ÙØ§ Ø­ÙÙˆÙ’Ù„Ù ÙˆÙÙ„ÙØ§ Ù‚ÙÙˆÙÙ‘Ø©Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø¨ÙØ§Ù„Ù„ÙÙ‘Ù‡Ù" (La hawla wa la quwwata illa billah)

Wallahu a'lam bissawab. Semoga Allah makbulkan doa kita semua! ğŸŒŸâœ¨`
                    }
                ];
            }
        }

        // Initialize chat when page loads
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸš€ Ustaz HTML: DOM loaded, initializing chat...');
            console.log('ğŸ” Ustaz HTML: Current URL:', window.location.href);
            console.log('ğŸ”— Ustaz HTML: Proxy URL configured as:', GEMINI_CONFIG.PROXY_URL);
            
            try {
                const ustazChat = new UstazRadhiChat();
                console.log('âœ… Ustaz HTML: Chat initialized successfully');
                
                // Make chat instance globally accessible for debugging
                window.ustazChat = ustazChat;
                
                // Add a test function for debugging
                window.testUstazChatAPI = async function(testMessage = "Assalamualaikum, test message") {
                    console.log('ğŸ§ª Testing Ustaz Chat API connection...');
                    try {
                        const response = await ustazChat.callGeminiAPI(testMessage);
                        console.log('âœ… Ustaz Chat API Test Success:', response);
                        return response;
                    } catch (error) {
                        console.error('âŒ Ustaz Chat API Test Failed:', error);
                        return error.message;
                    }
                };
                
                console.log('ğŸ§ª Use window.testUstazChatAPI() in console to test the API connection');
                
            } catch (initError) {
                console.error('âŒ Failed to initialize Ustaz Chat:', initError);
            }
            
            // Mobile menu functionality
            const mobileMenuToggle = document.getElementById('mobileMenuToggle');
            const mobileMenu = document.getElementById('mobileMenu');
            const menuIcon = document.getElementById('menuIcon');

            if (mobileMenuToggle && mobileMenu && menuIcon) {
                mobileMenuToggle.addEventListener('click', () => {
                    mobileMenu.classList.toggle('hidden');
                    
                    // Toggle menu icon animation
                    if (mobileMenu.classList.contains('hidden')) {
                        menuIcon.style.transform = 'rotate(0deg)';
                    } else {
                        menuIcon.style.transform = 'rotate(180deg)';
                    }
                });

                // Close mobile menu when clicking outside
                document.addEventListener('click', (e) => {
                    if (!mobileMenuToggle.contains(e.target) && !mobileMenu.contains(e.target)) {
                        mobileMenu.classList.add('hidden');
                        menuIcon.style.transform = 'rotate(0deg)';
                    }
                });

                // Close mobile menu on escape key
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && !mobileMenu.classList.contains('hidden')) {
                        mobileMenu.classList.add('hidden');
                        menuIcon.style.transform = 'rotate(0deg)';
                    }
                });
            }

            // Islamic Sources Toggle functionality
            const sourcesToggle = document.getElementById('sourcesToggle');
            const sourcesContent = document.getElementById('sourcesContent');
            const sourcesArrow = document.getElementById('sourcesArrow');

            if (sourcesToggle && sourcesContent && sourcesArrow) {
                sourcesToggle.addEventListener('click', () => {
                    sourcesContent.classList.toggle('hidden');
                    
                    // Toggle arrow animation
                    if (sourcesContent.classList.contains('hidden')) {
                        sourcesArrow.style.transform = 'rotate(0deg)';
                        sourcesArrow.textContent = 'â–¼';
                    } else {
                        sourcesArrow.style.transform = 'rotate(180deg)';
                        sourcesArrow.textContent = 'â–²';
                    }
                });
            }
        });
    </script>

</body>
</html>
